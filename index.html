<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="favicon.ico" type="image/x-icon"/ >
    
    <title>Snap Development Documentation</title>
    <meta name="description" content="This documentation guides a developer through the steps necessary to develop Snaps for the SnapLogic Elastic Integration Platform." />
    
    <!-- Twitter Card data -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@SnapLogic">
	<meta name="twitter:title" content="Snap Development Documentation">
	<meta name="twitter:description" content="A guide for developers creating Snaps for the SnapLogic Elastic Integration Platform.">
	<meta name="twitter:creator" content="@robinhowlett">
	<meta name="twitter:image" content="http://i.imgur.com/Z2XRe5j.png">

	<!-- Open Graph data -->
	<meta property="og:title" content="Snap Development Documentation" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="http://developer.snaplogic.com/" />
	<meta property="og:image" content="http://i.imgur.com/Z2XRe5j.png" />
	<meta property="og:description" content="A guide for developers creating Snaps for the SnapLogic Elastic Integration Platform." /> 
	<meta property="og:site_name" content="SnapLogic" />
	<meta property="fb:admins" content="669959809" />
	
	<!-- Google Search Console verification -->
	<meta name="google-site-verification" content="Y5HefmIT29LMZPMWI4B6aCgKFIDgH1H49VwABxZM-r8" />

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
    
	<!-- Google Analytics -->
    <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-39614376-8', 'auto');
	  ga('send', 'pageview');

	</script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <!--<div>
      	<ul class="tocify-header"><li id="expand-collapse" class="tocify-item"><a>Expand All</a></li></ul>
      </div>-->
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://doc.snaplogic.com'>Product Documentation</a></li>
            <li><a href='https://www.snaplogic.com'>SnapLogic website</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>This documentation guides a developer through the steps necessary to develop <strong>Snaps</strong> for the <a href="https://www.snaplogic.com/">SnapLogic Elastic Integration Platform</a>.</p>
<h2 id='snaps-and-snap-packs'>Snaps and Snap Packs</h2>
<p>SnapLogic <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1439259/Snap+Reference">Snaps</a> are modular collections of integration components built for a specific application or data source. Snaps shield both business users and developers from much of the complexity of the underlying application, data model, and service.</p>

<p><img src="images/WmuJ.png" alt="Transform Snap Pack" /></p>

<p>Snap Packs logically organize Snaps and are the deployable unit when adding/modifying Snaps to the SnapLogic Elastic Integration Platform. For instance, in the above example, the Aggregate Snap is part of the Transform Snap Pack. </p>

<p>Snaps may be related by functionality or share common code. A Snap Pack may contain a single Snap or multiple Snaps.</img></p>
<h2 id='snap-fundamentals'>Snap Fundamentals</h2>
<p>Snaps are streaming data processors. They can consume and/or produce Binary or Document data through input and output views, and can report error Documents to an optional error view. </p>

<p><img src="images/iKCt.png" alt="Snap Anatomy" /></p>

<p>They have metadata that define their view settings and configuration. They can read/poll from an endpoint, batch execute or process each input individually, and may write to another endpoint.</p>

<p>Snaps can provide design-time Suggest/lookup and Preview/validate data capabilities, or run in full execution mode.</p>

<p><img src="images/Yjfr.png" alt="Snap Execution" /></p>
<h2 id='snaps-vs-scripts'>Snaps vs Scripts</h2>
<p>SnapLogic&#39;s <a href="http://doc.snaplogic.com/com-snaplogic-snaps-script-script_2">Script Snap</a> executes a JavaScript, Jython, or JRuby script using the JVM <code>ScriptEngine</code> mechanism. </p>

<p>Consider the following when deciding whether to develop a custom Snap vs using the Script Snap:</p>

<table><thead>
<tr>
<th>Custom Snap</th>
<th>Script Snap</th>
</tr>
</thead><tbody>
<tr>
<td>Supports easy configuration without coding</td>
<td>Working directly with code</td>
</tr>
<tr>
<td>Supports pipeline <code>_parameters</code></td>
<td>Does not support pipeline <code>_parameters</code></td>
</tr>
<tr>
<td>Supports Binary or Document input/output</td>
<td>Supports only Document input/output</td>
</tr>
<tr>
<td>Supports Accounts, simplify impersonation</td>
<td>Does not support Accounts</td>
</tr>
<tr>
<td>Supports debugging during development</td>
<td>Often awkward to debug</td>
</tr>
<tr>
<td>Supports unit testing during/after development</td>
<td>Cannot be unit tested</td>
</tr>
<tr>
<td>Java</td>
<td>JavaScript, Jython, or JRuby</td>
</tr>
<tr>
<td>Need to build/deploy/etc</td>
<td>No deployment, quick &amp; simple</td>
</tr>
</tbody></table>
<h1 id='prerequisites'>Prerequisites</h1>
<ul>
<li>Java 11 (JDK)</li>
<li>Maven 3.2.1 or later</li>
<li>A Snaplex</li>
</ul>

<aside class="notice">
We also recommend using an Java IDE like <a href="https://www.jetbrains.com/idea">IntelliJ IDEA</a> or <a href="https://eclipse.org/ide/">Eclipse</a>.
</aside>
<h1 id='setting-up-the-snaplex'>Setting up the Snaplex</h1>
<p>A <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1437953/Snaplex">Snaplex</a> is the data processing engine of the <a href="https://www.snaplogic.com/products/how-it-works">SnapLogic Elastic Integration Platform</a>. A locally-installed/on-premises Snaplex (also known as a &quot;Groundplex&quot; or &quot;JCC&quot;) will be used throughout this guide to develop, execute and debug a Snap.</p>
<h2 id='downloads'>Downloads</h2>
<p>A Snaplex may be installed on:</p>

<ul>
<li>Linux</li>
<li>Microsoft Windows</li>
<li>macOS (for development only)</li>
</ul>

<aside class="notice">
The current list of Snaplex downloads is maintained at <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1438332/Snaplex+Downloads">https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1438332/Snaplex+Downloads</a>.
</aside>
<h2 id='installation'>Installation</h2>
<p>A Snaplex is the data processing engine of the SnapLogic Elastic Integration Platform. An Org admin can select <strong>Provision this user as a Snap Developer</strong> in the <strong>Update User</strong> dialog, automatically creating a dedicated Snaplex for that user to run and test pipelines. This Snaplex should be created in the Snap Developer’s project folder so that other users do not inadvertently run production pipelines on that Snaplex.</p>
<h3 id='linux-amp-microsoft-windows'>Linux &amp; Microsoft Windows</h3>
<p>Please visit the official SnapLogic documentation for detailed instructions for installing a Snaplex on <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1438367/Snaplex+Installation+on+Linux">Linux</a> or <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1439002/Snaplex+Installation+on+Windows">Microsoft Windows</a>. </p>
<h3 id='macos'>macOS</h3>
<aside class="warning">
Use of a Snaplex in a macOS environment is supported only for developing Snaps.
</aside>
<pre class="highlight shell tab-shell"><code><span class="gp">$ </span><span class="nb">cd</span> ~
<span class="gp">$ </span>brew install wget
<span class="gp">$ </span>wget https://s3.amazonaws.com/elastic.snaplogic.com/snaplogic-sidekick...rpm
<span class="gp">$ </span>/usr/bin/ruby -e <span class="s2">"</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">"</span>
<span class="gp">$ </span>brew install rpm2cpio
<span class="gp">$ </span>rpm2cpio.pl snaplogic-sidekick...rpm | cpio -idvm
<span class="gp">$ </span>mkdir -p ~/opt/snaplogic/etc
<span class="gp">$ </span>unzip myplex.slpropz -d ~/opt/snaplogic/etc
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'export SL_ROOT=~/opt/snaplogic'</span> &gt;&gt; ~/.bash_profile
<span class="gp">$ </span><span class="nb">source</span> ~/.bash_profile
</code></pre>
<blockquote>
<p>If successful, the output of the <code>cpio</code> command will list the Snaplex files populating the newly created <code>~/opt/snaplogic</code> directory, for example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="gp">$ </span>rpm2cpio.pl snaplogic-sidekick-4.mrc244-x86_64.rpm | cpio -idvm
./opt/snaplogic/bin/functions
./opt/snaplogic/bin/jcc.sh
./opt/snaplogic/bin/logstash.sh
./opt/snaplogic/ldlib/libsapjco3.jnilib
./opt/snaplogic/ldlib/libsapjco3.so
./opt/snaplogic/pkgs/jre1.8.0_45/COPYRIGHT
...
./opt/snaplogic/run/lib/jcc.war
./opt/snaplogic/run/lib/logstash.jar
./opt/snaplogic/run/log
1044673 blocks
</code></pre>
<ol>
<li><code>cd</code> to your home directory</li>
<li>Instructions for downloading the <code>.rpm</code> file can be found <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1438332/Snaplex+Downloads">here</a></li>
<li>Download and install <a href="https://brew.sh/">Homebrew</a></li>
<li>Install the <code>rpm2cpio</code> library</li>
<li>Extract the downloaded Snaplex <code>.rpm</code> file</li>
<li>Unzip the downloaded <code>.slpropz</code> file to the <code>etc</code> directory of your Snaplex</li>
<li>Export the <code>SL_ROOT</code> environment variable to your <code>~/.bash_profile</code></li>
</ol>
<h2 id='running'>Running</h2><pre class="highlight shell tab-shell"><code><span class="gp">$ </span><span class="nb">cd</span> ~/opt/snaplogic/run/lib
<span class="gp">$ </span>java -jar jcc.war jcc
</code></pre>
<blockquote>
<p>If successful, the output of the <code>java</code> command will be similar to this:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>...
    +- file:/Users/snapdev/opt/snaplogic/run/lib/jcc/zookeeper-3.4.6.jar
    +- sun.misc.Launcher<span class="nv">$AppClassLoader</span>@42a57993
        +- file:/Users/snapdev/opt/snaplogic/run/lib/jcc.war
        +- sun.misc.Launcher<span class="nv">$ExtClassLoader</span>@14ae5a5
2016-07-01T00:59:04,505 I main  <span class="o">[</span>  <span class="o">]</span> Server listening <span class="k">for </span>incoming connections
</code></pre>
<p>The simplest way to start the Snaplex is to run the packaged <code>jcc.war</code> file.</p>

<p>To check if the Snaplex started correctly, log in to the <a href="https://elastic.snaplogic.com/sl/dashboard.html">SnapLogic Dashboard</a>:</p>

<p><img src="images/1Z0t.png" alt="SnapLogic Dashboard Snaplex Health" /></p>

<aside class="success">
A green check mark beside the Snaplex entry will indicate a healthy instance.
</aside>
<h1 id='snap-anatomy-101'>Snap Anatomy 101</h1><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.snaplogic.api.ConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.api.ExecutionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.api.Snap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.common.properties.builders.PropertyBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.PropertyValues</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.SnapCategory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.General</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.Version</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.Inputs</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.Outputs</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.Errors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.api.capabilities.ViewType</span><span class="o">;</span>

<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Snap Name"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Description"</span><span class="o">,</span> 
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://www.docs.com/mysnap"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySnap</span> <span class="kd">implements</span> <span class="n">Snap</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>At its most basic, a Snap class declares the required name, view, version and category metadata annotations and implements the <code>Snap</code> interface.</p>
<h3 id='metadata-annotations'>Metadata annotations</h3>
<ul>
<li><code>@General</code>: name, description, author, and documentation link for the Snap.</li>
<li><code>@Inputs</code>: specifies the minimum and maximum number of Input Views and the type of input they accept (JSON Documents or Binary data).</li>
<li><code>@Outputs</code>: specifies the minimum and maximum number of Output Views and the type of output they produce (JSON Documents or Binary data).</li>
<li><code>@Errors</code>: specifies whether an Error Views should be written to</li>
<li><code>@Version</code>: version number for the Snap (not to be confused with the Snap Pack version).</li>
<li><code>@Category</code>: <a href="#snap-categories">categorizes the Snap</a> and determines the icon/color of the Snap within the SnapLogic Designer.</li>
</ul>
<h3 id='snap-interface'>Snap interface</h3>
<p>The <code>com.snaplogic.api.Snap</code> interface that should be implemented by the Snap developers to convert their business logic into an entity that can be used inside SnapLogic Pipelines.</p>

<p><strong><code>defineProperties</code></strong></p>

<p>Defines the Snap properties using the given <code>PropertyBuilder</code>. This method is called during <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Build_Lifecycle_Basics">the <code>compile</code> phase</a> and generates the <code>settings</code> Snap schema property that the SnapLogic Designer uses to build the user interface.</p>

<p><strong><code>configure</code></strong></p>

<p>Configures the Snap with the <code>PropertyValues</code> provided by the user&#39;s input to the Snap Settings. Input validation should be done here - if there is an issue with the provided input, a <code>ConfigurationException</code> should be thrown.</p>

<p><strong><code>execute</code></strong></p>

<p>Executes the Snap&#39;s business logic. Should an error be encountered, an <code>ExecutionException</code> may be thrown.</p>

<p><strong><code>cleanup</code></strong></p>

<p>Cleans up any suitable resources after the Snap execution. Again, should an error be encountered, an <code>ExecutionException</code> may be thrown.</p>

<aside class="notice">
Both <code>ConfigurationException</code> and <code>ExecutionException</code> are implementations of the root <code>SnapException</code> interface.

See the <a href="#exceptions-and-error-views">Exceptions and Error Views</a> section for more information.
</aside>
<h1 id='getting-started'>Getting Started</h1><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>mkdir ~/opt/snaplogic-dev
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'export SNAP_HOME=~/opt/snaplogic-dev'</span> &gt;&gt; ~/.bash_profile
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'export JCC_DEBUG_PORT=9000'</span> &gt;&gt; ~/.bash_profile
<span class="gp">$ </span><span class="nb">source</span> ~/.bash_profile
</code></pre>
<p>If a healthy Snaplex is running locally, Snap Development may begin. </p>

<p>Make a directory where Snap Development will occur, export the location as the <code>SNAP_HOME</code> environment variable and set the port to use for debugging.</p>
<h2 id='debugging'>Debugging</h2><pre class="highlight shell tab-shell"><code><span class="gp">$ </span><span class="nb">cd</span> ~/opt/snaplogic/run/lib
<span class="gp">$ </span>java -agentlib:jdwp<span class="o">=</span><span class="nv">transport</span><span class="o">=</span>dt_socket,server<span class="o">=</span>y,address<span class="o">=</span><span class="k">${</span><span class="nv">JCC_DEBUG_PORT</span><span class="k">}</span>,suspend<span class="o">=</span>n -jar jcc.war jcc
</code></pre>
<blockquote>
<p>This will wait to launch the JCC until you have attached the debugger.</p>
</blockquote>

<p>The Snaplex/JCC supports debugging a Snap&#39;s execution with your chosen IDE. Simply launch the JCC with the additional <code>agentlib</code> parameter with shown value, and attach to it using your IDE&#39;s remote debugging capability.</p>
<h2 id='snap-maven-archetype'>Snap Maven Archetype</h2><pre class="highlight plaintext"><code>$ cd $SNAP_HOME
$ mvn org.apache.maven.plugins:maven-archetype-plugin:2.4:generate -DarchetypeCatalog=http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------&lt; org.apache.maven:standalone-pom &gt;-------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] --------------------------------[ pom ]---------------------------------
[INFO] 
[INFO] &gt;&gt;&gt; maven-archetype-plugin:2.4:generate (default-cli) &gt; generate-sources @ standalone-pom &gt;&gt;&gt;
[INFO] 
[INFO] &lt;&lt;&lt; maven-archetype-plugin:2.4:generate (default-cli) &lt; generate-sources @ standalone-pom &lt;&lt;&lt;
[INFO] 
[INFO] 
[INFO] --- maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom ---
[INFO] Generating project in Interactive mode
[INFO] No archetype defined. Using maven-archetype-quickstart (org.apache.maven.archetypes:maven-archetype-quickstart:1.0)
Choose archetype:
1: http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/ -&gt; com.snaplogic.tools:SnapArchetype (An archetype that creates a Snap Pack, with example Snaps provided)
Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): : 1
Define value for property 'groupId': : com.snaplogic
Define value for property 'artifactId': : demosnappack
Define value for property 'version':  1.0-SNAPSHOT: : 
Define value for property 'package':  com.snaplogic: : com.snaplogic.snaps
Define value for property 'organization': : Partners
Define value for property 'assetPath':  /Partners/shared: : /Partners/MyCompany/shared
Define value for property 'snapPack':  demosnappack: : Demo Snap Pack
Define value for property 'user': : cc+partners@snaplogic.com    (should match cc.username in $SL_ROOT/etc/keys.properties)
Confirm properties configuration:
groupId: com.snaplogic
artifactId: demosnappack
version: 1.0-SNAPSHOT
package: com.snaplogic.snaps
organization: Partners
assetPath: /Partners/MyCompany/shared
snapPack: Demo Snap Pack
user: cc+partners@snaplogic.com
 Y: : y
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating project from Archetype: SnapArchetype:4.25
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: groupId, Value: com.snaplogic
...
</code></pre><pre class="highlight plaintext"><code>~/.m2/settings.xml (needed if using Maven 3.8.1 or later to create the project from the archetype)

&lt;?xml version="1.0"?&gt;
&lt;settings xmlns="http://maven.apache.org/SETTINGS/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0                       https://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;
    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;thirdparty&lt;/id&gt;
            &lt;name&gt;Snaplogic-ThirdPartyMaven-Repository&lt;/name&gt;
            &lt;url&gt;http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty&lt;/url&gt;
            &lt;mirrorOf&gt;Snaplogic-ThirdPartyMaven-Repository,thirdparty,SnapArchetype-repo&lt;/mirrorOf&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;
&lt;/settings&gt;
</code></pre>
<p>A <a href="https://maven.apache.org/guides/introduction/introduction-to-archetypes.html">Maven Archetype</a> is a Maven project templating toolkit. SnapLogic provides <code>SnapArchetype</code> for quickly starting Snap development.</p>

<aside class="notice">
The Snap archetype catalog is available at <a href="http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/">http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/</a>
<p><p>
Version 3.0.0 of Maven Archetype Plugin removed the ability to reference a remote, non-central archetype catalog - hence the use of the 2.4 version of the plugin above. See <a href="https://issues.apache.org/jira/browse/ARCHETYPE-519">ARCHETYPE-519</a> for more details.
<p><p>
If using Maven 3.8.1 or later, you will need to update your Maven settings.xml file as shown.
</aside>

<p><code>SnapArchetype</code> ships with eight sample Snaps for demonstration purposes:</p>

<table><thead>
<tr>
<th>Sample</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Single Doc Generator</strong></td>
<td><em>Outputs a single document</em></td>
</tr>
<tr>
<td><strong>Doc Consumer</strong></td>
<td><em>Consumes documents</em></td>
</tr>
<tr>
<td><strong>Doc Generator</strong></td>
<td><em>Outputs <code>n</code> documents, where <code>n</code> is specified by the user as an expression</em></td>
</tr>
<tr>
<td><strong>Suggest</strong></td>
<td><em>Demonstrates suggest setting capabilities</em></td>
</tr>
<tr>
<td><strong>Property Types</strong></td>
<td><em>Shows creating a variety of different Snap UI settings</em></td>
</tr>
<tr>
<td><strong>Two Inputs</strong></td>
<td><em>Consuming from two different input sources</em></td>
</tr>
<tr>
<td><strong>Two Inputs Two Outputs</strong></td>
<td><em>Consuming from two different input sources, and outputting two different Documents</em></td>
</tr>
<tr>
<td><strong>Schema Example</strong></td>
<td><em>Demonstrating input and output schemas for IO validation</em></td>
</tr>
<tr>
<td><strong>Character Counter</strong></td>
<td><em>Binary input and output views</em></td>
</tr>
<tr>
<td><strong>Currency Converter</strong></td>
<td><em>Demonstrates dependency injection</em></td>
</tr>
<tr>
<td><strong>SnapWithAccount</strong></td>
<td><em>Authenticating with an <code>ExampleAccount</code></em></td>
</tr>
</tbody></table>

<aside class="warning">
If you choose a <code>groupId</code>/<code>package</code> value other than <code>com.snaplogic.snaps</code>, you must provide a HTTP URL value to the <code>docLink</code> parameter of a Snap's <code>@General</code> annotation on a Snap.
</aside>

<p>Once <code>SnapArchetype</code> has been generated, it can be imported as a Maven project into your IDE (<a href="https://www.jetbrains.com/help/idea/2016.1/importing-project-from-maven-model.html">IntelliJ IDEA</a>, <a href="https://books.sonatype.com/m2eclipse-book/reference/creating-sect-importing-projects.html">Eclipse</a>, <a href="http://wiki.netbeans.org/MavenBestPractices">Netbeans</a>).</p>
<h2 id='project-structure'>Project Structure</h2><pre class="highlight plaintext"><code>demosnappack
├── .mvn
│   └── maven.config
├── pom.xml
├── settings.xml
└── src
    ├── main
    │   ├── assembly
    │   │   ├── final.xml
    │   │   └── snap.xml
    │   ├── config
    │   │   └── directives
    │   ├── java
    │   │   └── com
    │   │       └── snaplogic
    │   │           └── snaps
    │   │               ├── CharacterCounter.java
    │   │               ├── CurrencyConverter.java
    │   │               ├── DocConsumer.java
    │   │               ├── DocGenerator.java
    │   │               ├── ExampleAccount.java
    │   │               ├── PropertyTypes.java
    │   │               ├── SchemaExample.java
    │   │               ├── SingleDocGenerator.java
    │   │               ├── SnapWithAccount.java
    │   │               ├── Suggest.java
    │   │               ├── TwoInputs.java
    │   │               └── TwoInputsTwoOutputs.java
    │   └── resources
    └── test
        ├── java
        │   └── com
        │       └── snaplogic
        │           └── snaps
        │               ├── CharacterCounterTest.java
        │               ├── CurrencyConverterTest.java
        │               ├── DocConsumerTest.java
        │               ├── DocGeneratorTest.java
        │               ├── PropertyTypesTest.java
        │               ├── SchemaExampleTest.java
        │               ├── SingleDocGeneratorTest.java
        │               ├── SnapWithAccountTest.java
        │               ├── SuggestTest.java
        │               └── TwoInputsTwoOutputsTest.java
        └── resources
            └── data
                ├── character_counter
                │   ├── binary_input.txt
                │   ├── character_counter_input_pointer.json
                │   └── expected
                │       └── characterCounter_WithSnapLogicAsInput_CountsOccurrences
                │           ├── outbin-output0-data-0.data
                │           └── outbin-output0-headers.json
                ├── currency_converter
                │   ├── exchange_rates_file.json
                │   ├── exchange_rates_from_file_properties.json
                │   ├── expected
                │   │   ├── currencyConversion_WithCustomInjector_ConvertsCorrectly-out.json
                │   │   ├── currencyConversion_WithExchangeRatesDataSupplier_ConvertsCorrectly-out.json
                │   │   ├── currencyConversion_WithExchangeRatesFromDataFiles_ConvertsCorrectly-out.json
                │   │   └── currencyConverstion_WithFieldMockedDirectly_ConvertsCorrectly-out.json
                │   └── input_documents.json
                ├── doc_generator
                │   ├── doc_generator_properties.json
                │   └── expected
                │       ├── docGenerator_WithExpectedErrorPath_OutputsErrorDocumentCorrectly-err.json
                │       ├── docGenerator_WithExpectedOutputPath_OutputsDocumentsCorrectly-out.json
                │       ├── docGenerator_WithProperties_OutputsCorrectNumberOfDocuments-out.json
                │       └── docGenerator_WithPropertyOverrides_OutputsCorrectNumDocuments-out.json
                ├── property_types
                │   ├── expected
                │   │   └── propertyTypes_WithFieldsCompositesAndTables_OutputsEvaluatedValuesDocument-out.json
                │   └── property_types_properties.json
                ├── schema_example
                │   ├── expected
                │   │   ├── schemaExample_WithInvalidData_OutputsErrorDocumentOnly-err.json
                │   │   └── schemaExample_WithValidData_OutputsDocument-out.json
                │   ├── schema_invalid_input.data
                │   └── schema_valid_input.data
                ├── single_doc_generator
                │   └── expected
                │       └── singleDocGenerator_WithOutputView_OutputsCorrectNumDocuments-out.json
                ├── snap_with_account
                │   ├── account_properties.json
                │   └── expected
                │       └── snapWithAccount_WithAccountProperties_OutputsCorrectToken-out.json
                ├── suggest
                │   ├── expected
                │   │   └── suggest_WithSuggestProperty_WritesResultsToSpecialOutputView-out.json
                │   └── suggest_properties.json
                └── two_inputs_two_outputs
                    ├── expected
                    │   └── twoInputsTwoOutputs_WithParentsAndChildren_GroupsByGender-out.json
                    └── input_files.json
</code></pre>
<p>A Snap Project&#39;s structure follows <a href="https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html">Maven&#39;s Standard Directory Layout</a>.</p>
<h3 id='src-main-assembly'><code>src/main/assembly</code></h3>
<p><code>final.xml</code> and <code>snap.xml</code> are used by the <code>maven-assembly-plugin</code> to build the Snap Pack zip file that can be uploaded to the SnapLogic Manager. You should not need to alter these files.</p>
<h3 id='src-main-config'><code>src/main/config</code></h3>
<p><code>directives</code> contains basic Snap Pack metadata. </p>

<p>The <code>NAME</code> property is the label of Snap Pack. This is visible when the SnapLogic Designer is grouping by Snap Pack e.g. the Snaps related to SQL Server are grouped under &quot;SQL Server&quot;.</p>

<p><img src="images/AUH9.png" alt="SQL Server Snap Pack label" /></p>

<p>The <code>ASSET_DIR_PATH</code> property instructs the Snap Pack Installer to deploy the Snap Pack to the specified asset path.</p>

<p>A customer will be deploying to an Organization root, Project, or Project Spaces asset path e.g. <code>/snaplogic/shared</code>, <code>/snaplogic/projects/rhowlett</code>, and <code>/snaplogic/robin/shared</code> respectively (where &quot;snaplogic&quot; is the Organization name assigned by SnapLogic to your account, &quot;rhowlett&quot; is the Project folder name, and &quot;robin&quot; is the Project Spaces. </p>

<p>This value can be changed dynamically at build time using the <code>-Dasset_path</code> Maven parameter (especially useful with a continuous integration tool, or if your company has multiple Organizations or wishes to deploy to multiple asset path locations).</p>
<h3 id='src-main-java-and-src-main-resources'><code>src/main/java</code> and <code>src/main/resources</code></h3>
<p>Files and folders within these directories will be on the classpath, as per Maven convention. This is where you will write your Snap code.</p>
<h3 id='src-test-java-and-src-test-resources'><code>src/test/java</code> and <code>src/test/resources</code></h3>
<p>Files and folders within these directories will be on the test classpath, as per Maven convention. Unit and integration tests (and supporting resources) are located in these directories.</p>
<h3 id='pom-xml'><code>pom.xml</code></h3>
<p>This is the Maven POM file. You will change this file when registering new Snaps and Accounts, when new dependencies or plugins are required, or when needing to modify the build properties.</p>

<p>The <code>dependencyManagement</code> section imports the SnapLogic BOM file, <code>com.snaplogic.snaps:bom</code>, to simplify dependency management:</p>
<pre class="highlight xml tab-xml"><code><span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- import dependency management declarations from the SnapLogic snaps BOM --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.snaplogic.snaps<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>bom<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${snaplogic.snaps.version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre>
<p>The <code>dependencies</code> section of the POM file can reference dependencies managed by the BOM file without specifying their version:</p>
<pre class="highlight xml tab-xml"><code><span class="c">&lt;!-- SnapLogic jsdk + japis dependencies, declared in bom --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.snaplogic<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jsdk<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.snaplogic<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jutils<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.snaplogic<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jtest<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- third-party dependencies bundled in jcc and declared in bom with provided scope --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
...
</code></pre>
<p>The POM also includes other <code>dependencies</code> needed by the sample Snaps:</p>
<pre class="highlight xml tab-xml"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-codec<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-codec<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-io<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-io<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.google.guava<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>guava<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
...
</code></pre><h1 id='developing-snaps'>Developing Snaps</h1>
<p>The <code>properties</code> section of the POM file has two properties, <code>snap.classes</code> and <code>account.classes</code>, which list the names
of the Java classes which define the Snaps and Accounts provided by this Snap pack:</p>
<pre class="highlight xml tab-xml"><code><span class="c">&lt;!-- This identifies the classes which represent the actual Snaps
    (and become accessible on the Snaplex/JCC after deployment).

    After creating a new Snap class, add it here.
--&gt;</span>
<span class="nt">&lt;snap.classes&gt;</span>
    com.snaplogic.snaps.CharacterCounter,
    com.snaplogic.snaps.CurrencyConverter,
    com.snaplogic.snaps.DocConsumer,
    com.snaplogic.snaps.DocGenerator,
    com.snaplogic.snaps.PropertyTypes,
    com.snaplogic.snaps.SchemaExample,
    com.snaplogic.snaps.SingleDocGenerator,
    com.snaplogic.snaps.SnapWithAccount,
    com.snaplogic.snaps.Suggest,
    com.snaplogic.snaps.TwoInputs,
    com.snaplogic.snaps.TwoInputsTwoOutputs
<span class="nt">&lt;/snap.classes&gt;</span>
<span class="c">&lt;!-- This identifies the classes which represent the actual Accounts
    (and become accessible on the Snaplex/JCC after deployment).

    After creating a new Account class, add it here.
--&gt;</span>
<span class="nt">&lt;account.classes&gt;</span>
    com.snaplogic.snaps.ExampleAccount
<span class="nt">&lt;/account.classes&gt;</span>
</code></pre>
<blockquote>
<p>pom.xml</p>
</blockquote>

<p>SnapLogic provides the <strong>JSDK</strong>, a library of Java APIs to assist with building Snaps. </p>

<p>The <a href="#snap-maven-archetype">Snap Maven Archetype</a> ships with sample Snaps that we can use to highlight the JSDK&#39;s capabilities.</p>
<h2 id='basic-snap-implementation'>Basic Snap Implementation</h2><pre class="highlight java tab-java"><code><span class="c1">// Set the Snap title, description etc</span>
<span class="c1">// Also, use the "docLink" parameter to set a link to the documentation</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Single Doc Generator"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Generates one document and completes"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="c1">// This Snap does not permit input views for demonstration purposes, however, in practice, there</span>
<span class="c1">// should almost always be an input view</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="c1">// This snap has exactly one document output view (min = 1, max = 1).</span>
<span class="c1">// Snaps can also have binary output i.e., offers={ViewType.BINARY}</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="c1">// This snap has an optional document error view(min = 1, max = 1).</span>
<span class="c1">// Snaps can also have binary error view i.e., offers={ViewType.BINARY}</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="c1">// Version number of the snap</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="c1">// This snap belongs to SnapCategory.READ as it is idempotent.</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingleDocGenerator</span> <span class="kd">implements</span> <span class="n">Snap</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SingleDocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">DocumentUtility</span> <span class="n">documentUtility</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">OutputViews</span> <span class="n">outputViews</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="n">counter</span><span class="o">++;</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"counter="</span> <span class="o">+</span> <span class="n">counter</span><span class="o">);</span>

        <span class="cm">/*
         * Write a single document to outputView. The next snap in the pipe will
         * only ever see a single document from this snap.
         */</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{{</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">);</span>
        <span class="o">}};</span>
        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p><code>SingleDocGenerator</code> is one of the sample Snaps included in the Snap Archetype. </p>

<p>It is an uncomplicated Snap that generates a single document, without requiring any input data or user input. It implements the <code>Snap</code> interface.</p>

<p><img src="images/o6o1.png" alt="SingleDocGeneratorPipeline" /></p>

<p><a href="#snap-anatomy-101">Snap Anatomy 101</a> explains the purpose of each annotation and the overridden methods. The comments above each annotation describe their specific usage for this Snap.</p>

<aside class="notice">
For simplicity, the <strong>"Single Doc Generator"</strong> Snap does not permit any input views. However, for general Snap development, there should <strong>almost always</strong> be an input view. See <a href="#reading-documents-from-an-input-view">Reading Documents from an Input View</a> for more.
</aside>
<h3 id='snap-lifecycle'>Snap Lifecycle</h3>
<p>At build time, <code>defineProperties</code> is called to generate the Snap Schema. This will construct the Snap&#39;s settings tab.</p>

<p>At runtime, the Snap is initialized by the Snaplex/JCC. Next, <a href="https://github.com/google/guice">Guice</a> injects the various declared dependency instances (<code>documentUtility</code> and <code>outputViews</code> in this Snap).</p>

<p>The Snaplex&#39;s runtime then instructs the Snap&#39;s <code>configure</code> method to be called to validate and/or operate on any provided <code>PropertyValues</code> created from a user&#39;s interaction with the Snap&#39;s settings.</p>

<p>Next, the <code>execute</code> method is called. This is where the majority of the Snap&#39;s business logic will initiate.</p>

<p>Finally, the <code>cleanup</code> method is called to clean-up any resources used.</p>

<p>Due to no user input being required, nor clean-up needed, the <code>defineProperties</code>, <code>configure</code>, and <code>cleanup</code> methods have no implementation for this Snap. </p>

<p>The <code>execute</code> method increments an <code>int</code> member variable, logs a debug statement, creates data, and generates a new Document with this data to be subsequently written to the output view.</p>
<h2 id='logging'>Logging</h2><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>brew install lnav
<span class="gp">$ </span>lnav -i https://snaplogic.box.com/v/lnav-log-format
<span class="gp">$ </span>lnav ~/opt/snaplogic/run/log/jcc.json

2016-07-13T13:10:35.072 DEBUG <span class="o">[</span>Single Doc Generator[5d64230b-fa22-4696-b736-05b599b06ba9 -- 9a3a88ef-d5b1-4715-945d-0c6a595f7940]] <span class="o">(</span>SingleDocGenerator.java:77<span class="o">)</span> - <span class="nv">counter</span><span class="o">=</span>1                                                                                      │
  snrd: 9a3a88ef-d5b1-4715-945d-0c6a595f7940                                                                                                                                                                                                                     │
  com.snaplogic.logging.id: 57868ceb64cabf28873d20a7.5d64230b-fa22-4696-b736-05b599b06ba9.9a3a88ef-d5b1-4715-945d-0c6a595f7940                                                                                                                                   │
  plrd: 5d64230b-fa22-4696-b736-05b599b06ba9                                                                                                                                                                                                                     │
  snlb: Single+Doc+Generator                                                                                                                                                                                                                                     │
  ccid: 57868ceb64cabf28873d20a7                                                                                                                                                                                                                                 │
  snii: 898c5459-0419-455c-9493-a0d6fbae9c8a                                                                                                                                                                                                                     │
  xid: a83bcfdd-2bc7-480e-bf1e-5fbdfef3c726   
</code></pre>
<p>In <a href="#basic-snap-implementation">the &quot;Single Doc Generator&quot; sample Snap</a> above, an SLF4J <code>Logger</code> static class variable is declared and initialized and is used to write debug messages to the Snaplex/JCC&#39;s log.</p>

<p>For example, when previewing or executing the &quot;Single Doc Generator&quot; Snap in the Designer, the value of the <code>counter</code> variable is written to the log. </p>

<p>This entry can then be viewed in the Snaplex&#39;s <code>jcc.json</code> log file (we recommend using <a href="https://www.snaplogic.com/blog/lnav/">LNAV, the log file navigator</a> created by SnapLogic&#39;s own Timothy Stack):</p>
<h2 id='creating-documents-with-documentutility'>Creating Documents with DocumentUtility</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">snap</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DocumentUtility</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="cm">/**
     * Returns a new document with the given data for the given incoming document.
     *
     * @param incomingDocument
     * @param data
     * @return document
     */</span>
    <span class="n">Document</span> <span class="nf">newDocumentFor</span><span class="o">(</span><span class="n">Document</span> <span class="n">incomingDocument</span><span class="o">,</span> <span class="n">Object</span> <span class="n">data</span><span class="o">);</span>

    <span class="cm">/**
     * Returns a new document object with the given data and merges the original data into the
     * new returned document.
     * This allows to "pass through" the data from an incoming document and merge it into the new
     * document being written to the output. The new document will have an {@literal original}
     * key holding the original document to avoid data being overwritten when merging the data
     * with original data
     *
     * @param document     as the document being written
     * @param originalData as original data being merged with the document.
     *
     * @return document
     * @throws UnsupportedOperationException only data and originalData of type Map is currently
     *                                       supported
     */</span>
    <span class="n">Document</span> <span class="nf">newDocument</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">Object</span> <span class="n">originalData</span><span class="o">);</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p>Guice&#39;s <code>@Inject</code> annotation will instruct the Snaplex/JCC to inject an instance of <code>DocumentUtility</code> and assign it to <code>documentUtility</code> (<a href="#basic-snap-implementation">see &quot;Single Doc Generator&quot; Snap above</a>).</p>

<p>Documents may be created with given data. </p>

<aside class="success">
Data should be created either as a single <code>LinkedHashMap</code> instance (to preserve field ordering) or a <code>List</code> of <code>LinkedHashMap</code> instances. Avoid data being just a primitive data type or <code>null</code>.
</aside>
<h3 id='lineage'>Lineage</h3>
<p>For Snaps that have input views and process documents, you should preserve <a href="https://en.wikipedia.org/wiki/Data_lineage">data lineage</a> (required by <a href="https://www.snaplogic.com/blog/ultra_pipeline_design">Ultra Pipelines</a>) between the new output document to be written and the incoming original document by using one of the highlighted <code>DocumentUtility</code> methods:</p>

<p><em>Establishes lineage between the new document and the incoming original document, but discards the incoming data:</em><br />
<code>Document newDocumentWithLineage = documentUtility.newDocumentFor(originalDocument, data);</code></p>

<p><em>Establishes lineage between the new document and the incoming original document and &quot;passes through&quot; the incoming document&#39;s data by adding a key named &quot;original&quot; (containing the incoming original document&#39;s data) to the new document:</em><br />
<code>Document seed = documentUtility.newDocument(newData);</code><br />
<code>Document newDocumentWithLineage = documentUtility.newDocument(seed, originalDocument);</code></p>

<aside class="success">
We recommend that you do pass through the original document for greatest flexibility.
</aside>
<h2 id='writing-documents-to-an-output-view'>Writing Documents to an Output View</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">snap</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>

<span class="cm">/**
 * OutBoundViews is the base interface for all the output views - {@link OutputView} and
 * {@link com.snaplogic.snap.view.ErrorView}
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OutBoundViews</span><span class="o">&lt;</span><span class="n">V</span> <span class="kd">extends</span> <span class="n">OutputView</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Views</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="cm">/**
     * Writes the given document to all the outbound views of the Snap.
     *
     * @param document
     */</span>
    <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">);</span>

    <span class="cm">/**
     * Writes a new document object with the given data and merges the original data into the
     * new returned document.
     * This allows to "pass through" the data from an incoming document and merge it into the new
     * document being written to the output. The new document will have an {@literal original}
     * key holding the original document to avoid data being overwritten when merging the data
     * with original data.
     *
     * @param document     as the document being written
     * @param originalData as original data being merged with the document.
     *
     * @return document
     * @throws UnsupportedOperationException only data and originalData of type Map is currently
     *                                       supported
     */</span>
    <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">Object</span> <span class="n">originalData</span><span class="o">);</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p>Guice&#39;s <code>@Inject</code> annotation will instruct the Snaplex/JCC to inject an instance of <code>OutputViews</code> and assign it to <code>outputViews</code> (<a href="#basic-snap-implementation">see &quot;Single Doc Generator&quot; Snap above</a>).</p>
<h3 id='lineage-2'>Lineage</h3>
<p>Similarly to <a href="#creating-documents-with-documentutility">DocumentUtility</a>, output views can establish lineage between incoming and outgoing documents. This is useful when an outgoing Document has been created without lineage but the incoming original document is still accessible:</p>

<p><code>outputViews.write(documentWithoutLineage, originalDocument);</code></p>
<h2 id='unit-testing-snaps-with-snaptestrunner'>Unit Testing Snaps with SnapTestRunner</h2><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.snaplogic.snap.test.harness.OutputRecorder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.test.harness.SnapTestRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.test.harness.TestFixture</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.snap.test.harness.TestResult</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertNull</span><span class="o">;</span>

<span class="cm">/**
 * Tests that the {@link SingleDocGenerator} Snap sent one Document to the output view.
 */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingleDocGeneratorTest</span> <span class="o">{</span>

    <span class="c1">// "snap" attribute targets the Snap being executed</span>
    <span class="c1">// "outputs" defines the name of the output view to write to</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SingleDocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">singleDocGenerator_WithOutputView_OutputsCorrectNumDocuments</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">OutputRecorder</span> <span class="n">outputRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getOutputViewByName</span><span class="o">(</span><span class="s">"output0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">outputRecorder</span><span class="o">.</span><span class="na">getRecordedData</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>SingleDocGeneratorTest</code> class outlines basic usage of <strong>jtest</strong>, a JUnit-based Snap unit testing framework.</p>

<p>jtest provides <code>SnapTestRunner</code>, a custom JUnit test runner which simulates the targeted Snap being executed within a pipeline. </p>

<p>Test methods are annotated with the <code>@TestFixture</code> annotation, which specifies what Snap implementation to use, input/output/error views configured, property settings specified, accounts associated etc.</p>

<p>The test method should take a single <code>TestResult</code> argument, which can be used within the test to determine whether the correct output was written (using an <code>OutputRecorder</code>), if errors occurred etc.</p>

<p>In the <code>SingleDocGeneratorTest</code> sample provided, we can see that the test method focuses on examining that the <code>TestResult</code> did not receive any thrown exceptions, and that the declared output view registered the expected number of documents processed.</p>

<p>The <a href="#jtest-snap-unit-testing-framework">&quot;jtest: Snap Unit Testing Framework&quot;</a> section contains much more information about testing Snaps, including working towards a purely declarative style of Snap unit testing using just the test method&#39;s <code>@TestFixture</code> annotation.</p>
<h2 id='reading-documents-from-an-input-view'>Reading Documents from an Input View</h2><pre class="highlight java tab-java"><code><span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Doc Consumer"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Consumes the incoming documents"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">WRITE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocConsumer</span> <span class="kd">implements</span> <span class="n">Snap</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">DocConsumer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicInteger</span> <span class="n">count</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">InputViews</span> <span class="n">inputViews</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="n">InputView</span> <span class="n">inputView</span> <span class="o">=</span> <span class="n">inputViews</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">documentIterator</span> <span class="o">=</span> <span class="n">inputViews</span><span class="o">.</span><span class="na">getDocumentsFrom</span><span class="o">(</span><span class="n">inputView</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">documentIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">documentIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Received Document {}"</span><span class="o">,</span> <span class="n">doc</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">count</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Consumed {} documents"</span><span class="o">,</span> <span class="n">count</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>DocConsumer</code> sample Snap that ships with the <a href="#snap-maven-archetype">Snap Archetype</a> demonstrates how to read from a Snap&#39;s input view.</p>

<p>Similarly to <a href="#writing-documents-to-an-output-view">Writing Documents to an Output View</a>, Guice will inject an instance of <code>InputViews</code> and assign it to the <code>inputViews</code> variable.</p>

<p><code>inputViews.get()</code> returns the default view associated with the Snap. If the Snap has more than one view, a <code>ViewException</code> is thrown.</p>

<p>An <code>Iterator</code> of <code>Document</code> objects can then be acquired by asking the <code>InputViews</code> instance for the <code>Document</code> objects associated with the specified <code>InputView</code> instance.</p>

<p>Iterating over the <code>Document</code> objects, the Snap logs that a document was consumed and increments its <code>AtomicInteger</code> counter.</p>

<p>The <code>cleanup()</code> method, which is called after the Snap has completed its execution phase, logs the total number of documents consumed.</p>

<p><img src="images/KZdv.png" alt="Consuming 3 Documents" /></p>

<aside class="notice">
SnapLogic's Platform will enforce that all input documents have been fully consumed, otherwise an error will occur and the pipeline will fail.
<br />
<br />If some documents are consumed but "dropped on the floor" (not written to either an output or error view, or used to create another <code>Document</code>), call <code>document.acknowledge</code> to indicate it has been consumed.
</aside>
<h2 id='snap-categories'>Snap Categories</h2>
<p>The <a href="#reading-documents-from-an-input-view">Doc Consumer Snap&#39;s</a> category (<code>SnapCategory.WRITE</code>) differs from <a href="#basic-snap-implementation">SingleDocGenerator&#39;s</a> <code>SnapCategory.READ</code> category. </p>

<p>This difference between category types manifests in three ways:</p>

<ul>
<li>the color and icon of the Snaps are different,</li>
<li>the &quot;Doc Consumer&quot; Snap inherits an &quot;Execute during Preview&quot; setting to toggle whether the Snap will execute when the Pipeline is validating/previewing,</li>
<li>the Snaps are separated when &quot;Group By Type&quot; is chosen.</li>
</ul>

<p><img src="images/hEPI.png" alt="Snap Category Difference" /></p>

<table><thead>
<tr>
<th>Icon</th>
<th>Snap Category</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><img src="images/xzQs.png" /></td>
<td><strong>READ</strong></td>
<td>Sources of data in the pipeline.<br /><em>Example: File Reader</em></td>
</tr>
<tr>
<td><img src="images/QJ63.png" /></td>
<td><strong>WRITE</strong></td>
<td>Data destinations or sinks in the pipeline. They also inherit an &quot;Execute during Preview&quot; setting.<br /><em>Example: File Writer</em></td>
</tr>
<tr>
<td><img src="images/HmYs.png" /></td>
<td><strong>PARSE</strong></td>
<td>Parse unstructured input data into structured output data.<br /><em>Example: CSV Parser</em></td>
</tr>
<tr>
<td><img src="images/LNZC.png" /></td>
<td><strong>FORMAT</strong></td>
<td>Change data format.<br /><em>Example: CSV Formatter</em></td>
</tr>
<tr>
<td><img src="images/oETU.png" /></td>
<td><strong>TRANSFORM</strong></td>
<td>Modify data significantly.<br /><em>Example: Aggregate, Join</em></td>
</tr>
<tr>
<td><img src="images/NQNT.png" /></td>
<td><strong>FLOW</strong></td>
<td>Change the direction or output of data in the pipeline.<br /><em>Example: Filter, Router</em></td>
</tr>
</tbody></table>

<p>As you develop Snaps, choose the appropriate Snap Category for your use cases.</p>
<h2 id='bootstrapping-with-simplesnap'>Bootstrapping with SimpleSnap</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * This snap accepts two inputs and outputs to a single output. To use it, feed
 * it two JSON documents. It will output a single stream which consists
 * of the combination of the two inputs, plus an additional "Processed" field in each.
 *
 * &lt;p&gt;This Snap extends {@link SimpleSnap} (instead of implementing {@link Snap}).&lt;/p&gt;
 * &lt;p&gt;This means that instead of having a method called 'execute' which is called once,
 * it has a method called 'process' which is called for every document the snap receives.
 * This means you do not have to iterate over incoming documents as 'process' does that
 * for you.
 */</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Two Inputs"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Accepts two inputs (expected phone books, merges them)"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwoInputs</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">TwoInputs</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">OutputViews</span> <span class="n">outputViews</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">String</span> <span class="n">inputViewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Demonstrates how to create a new copy of the document</span>
        <span class="n">Document</span> <span class="n">newdoc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>

        <span class="c1">// get a map representation of the document</span>
        <span class="c1">// NOTE: we are *not* duplicating the data.</span>
        <span class="c1">// We will *not* have to convert the map back to a doc.</span>
        <span class="c1">// It's just a pointer representation.</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">newdoc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// assign a value to a field of the map</span>
        <span class="c1">// In this case, we are just assigning 'processed=True'</span>
        <span class="c1">// to signal that the document has been processed.</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"processed"</span><span class="o">,</span> <span class="s">"True"</span><span class="o">);</span>

        <span class="n">count</span><span class="o">++;</span>
        <span class="c1">// log current document number</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"count="</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>

        <span class="c1">// log current document</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"document: "</span> <span class="o">+</span> <span class="n">newdoc</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>

        <span class="c1">// send new document to next snap</span>
        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">newdoc</span><span class="o">,</span> <span class="n">document</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="c1">// Log final number of documents processed</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Final count="</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Now that we understand the basics of a Snap, we can extend the <code>SimpleSnap</code> class to have some of the heavy lifting done for us.</p>

<p><code>SimpleSnap</code> provides all the necessary hooks for writing a new Snap. A Snap author can write a new Snap by simply extending <code>SimpleSnap</code>, adding the desired metadata annotations (<code>SimpleSnap</code> already declares an <code>@Errors</code> view that can be overridden), and providing the implementation for the <code>process</code> method (and optionally, for the <code>defineProperties</code> and <code>configure</code> methods too).</p>

<p><code>SimpleSnap</code> takes care of iterating over the incoming documents (if any) and allowing you to process each document at a time. It also handles the dependency injection for the <code>Input/Output/ErrorViews</code>, the <code>DocumentUtility</code>, and the <code>ExecutionUtil</code> (which handles iterating over the documents in the incoming input view(s) on your behalf, and writing any thrown <code>SnapDataException</code> instances to the error view).</p>

<p><img src="images/IVTO.png" alt="Two Inputs" /></p>

<p>There are a number of other &quot;Simple&quot; Snap implementations that can help getting started quickly, including:</p>

<ul>
<li><code>SimpleReadSnap</code></li>
<li><code>SimpleWriteSnap</code></li>
<li><code>SimpleBinarySnap</code></li>
<li><code>SimpleBinaryReadSnap</code></li>
<li><code>SimpleTransformSnap</code></li>
<li><code>SimpleBinaryWriteSnap</code></li>
</ul>
<h2 id='writing-binary-data-to-an-output-view'>Writing Binary Data to an Output View</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * A Snap that counts the number of occurrences of each letter in the English language for the
 * incoming data, and writes the result to a binary output view
 */</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Character Counter"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Demo writing to Binary Output View"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="n">ViewType</span><span class="o">.</span><span class="na">BINARY</span><span class="o">)</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">)</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharacterCounter</span> <span class="kd">extends</span> <span class="n">SimpleBinaryWriteSnap</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="kd">final</span> <span class="n">Document</span> <span class="n">header</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ReadableByteChannel</span> <span class="n">readChannel</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>

        <span class="c1">// Guava Multiset</span>
        <span class="kd">final</span> <span class="n">Multiset</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">&gt;</span> <span class="n">bagOfChars</span> <span class="o">=</span> <span class="n">HashMultiset</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">(</span><span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">Channels</span><span class="o">.</span><span class="na">newInputStream</span><span class="o">(</span><span class="n">readChannel</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Reader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedInputStream</span><span class="o">(</span><span class="n">inputStream</span><span class="o">),</span> <span class="n">UTF_8</span><span class="o">);</span>

            <span class="c1">// read in each character</span>
            <span class="kt">int</span> <span class="n">characterRead</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">characterRead</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">())</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// add the lowercase version of the character to the Multiset</span>
                <span class="n">bagOfChars</span><span class="o">.</span><span class="na">add</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="n">Character</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(</span><span class="n">characterRead</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">errorViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="k">new</span> <span class="n">SnapDataException</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()),</span> <span class="n">header</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// for each letter of English alphabet, write a line with the number of times</span>
            <span class="c1">// it appeared in the input data</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">letter</span> <span class="o">=</span> <span class="sc">'a'</span><span class="o">;</span> <span class="n">letter</span> <span class="o">&lt;=</span> <span class="sc">'z'</span><span class="o">;</span> <span class="n">letter</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">letter</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">":"</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">bagOfChars</span><span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="n">letter</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">lineSeparator</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// write to the error view when a problem processing the input data is encountered</span>
            <span class="n">SnapDataException</span> <span class="n">ex</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SnapDataException</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="s">"Unable to complete counting "</span>
                    <span class="o">+</span> <span class="s">"characters from input data."</span><span class="o">).</span><span class="na">withResolutionAsDefect</span><span class="o">();</span>

            <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"content"</span><span class="o">,</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>

            <span class="n">errorViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">ex</span><span class="o">,</span> <span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="k">new</span> <span class="n">BinaryOutput</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Document</span> <span class="nf">getHeader</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">header</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">WritableByteChannel</span> <span class="n">writeChannel</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">(</span><span class="n">OutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="n">Channels</span><span class="o">.</span><span class="na">newOutputStream</span><span class="o">(</span><span class="n">writeChannel</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">IOUtils</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">outputStream</span><span class="o">,</span> <span class="n">UTF_8</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p>While JSON-based Documents offer the greatest flexibility of manipulating data within a pipeline, Binary data has advantages too. The costs associated with parsing and formatting data to JSON are avoided, and it can allow easier integration with processes running externally to the pipeline.</p>

<p>The <code>CharacterCounter</code> sample Snap shown demonstrates writing to a binary output view. It counts the number of times each letter of the English alphabet appears in the incoming binary data, and then writes the results to the binary output view (or, if there were any exceptions, creates an error Document and writes that to the error view).</p>

<p>In the sample, the <code>process()</code> method&#39;s implementation writes an anonymous <code>BinaryOutput</code> instance to the Snap&#39;s output view. </p>

<p>The provided <code>ReadableByteChannel</code> argument is used to create an <code>InputStream</code>. The logic for counting each occurrence of each letter then follows before the results are written to an <code>OutputStream</code>, which is sent the <code>write()</code> method&#39;s <code>WritableByteChannel</code>, and then on to the Snap&#39;s binary output view:</p>

<p><img src="images/xNKZ.png" alt="Character Counter Binary Output" /></p>
<h2 id='reading-binary-data-from-an-input-view'>Reading Binary Data from an Input View</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">snap</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">write</span><span class="o">;</span>
<span class="o">...</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">BINARY</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">WRITE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SimpleBinaryWriteSnap</span> <span class="kd">extends</span> <span class="n">SimpleBinarySnap</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">InputViews</span> <span class="n">inputViews</span><span class="o">;</span>

    <span class="c1">// called by SimpleBinarySnap.execute()</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doWork</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">InputView</span> <span class="n">inputView</span> <span class="o">:</span> <span class="n">inputViews</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">BinaryInput</span> <span class="n">binaryData</span> <span class="o">:</span> <span class="n">inputViews</span><span class="o">.</span><span class="na">binaryInputs</span><span class="o">(</span><span class="n">inputView</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">ReadableByteChannel</span> <span class="n">readChannel</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">readChannel</span> <span class="o">=</span> <span class="n">binaryData</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>
                    <span class="n">process</span><span class="o">(</span><span class="n">binaryData</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(),</span> <span class="n">readChannel</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ExecutionException</span><span class="o">(</span><span class="n">e</span><span class="o">,</span>
                            <span class="n">EXCEPTION_WHILE_READING_FROM_BINARY_INPUT</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">IOUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">readChannel</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Processes the incoming binary data.
     */</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">header</span><span class="o">,</span> <span class="n">ReadableByteChannel</span> <span class="n">readChannel</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<p>The <code>CharacterCounter</code> class above extends the abstract <code>SimpleBinaryWriteSnap</code> class which, similarly to <a href="#bootstrapping-with-simplesnap">Bootstrapping with SimpleSnap</a>, provides some sensible default values for metadata annotations and some initial implementation.</p>

<p>The <code>doWork()</code> method iterates over the Snap&#39;s binary input views, returning a <code>BinaryInput</code> instance for each view. The <code>BinaryInput</code> contains a <code>ReadableByteChannel</code> (which can read the bytes of the incoming binary data) and a Document header containing basic metadata (<code>content-type</code> etc.).</p>

<p>As shown <a href="#writing-binary-data-to-an-output-view">in the <strong>&quot;Character Counter&quot;</strong> sample above</a>, these can then be used to create an <code>InputStream</code> or simliar to access and/or manipulate the binary data.</p>
<h3 id='headers'>Headers</h3>
<p>Binary Headers are Documents used to store useful metadata about the binary data stream.</p>

<p>When creating <code>BinaryOutput</code> instances, a Document header should be created and returned in <code>getHeader()</code>.</p>

<aside class="success">
We recommend using standard/popular specification field names, lowercased, when possible e.g. <code>"content-type"</code>, from the HTTP specification.
</aside> 
<h2 id='accepting-user-input-with-propertybuilder'>Accepting User Input with PropertyBuilder</h2><pre class="highlight java tab-java"><code><span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Doc Generator"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Generates documents based on the configuration"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocGenerator</span> <span class="kd">implements</span> <span class="n">Snap</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COUNT</span> <span class="o">=</span> <span class="s">"count"</span><span class="o">;</span>

    <span class="c1">// Document utility is the only way to create a document</span>
    <span class="c1">// or manipulate the document header</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">DocumentUtility</span> <span class="n">documentUtility</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">OutputViews</span> <span class="n">outputViews</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ErrorViews</span> <span class="n">errorViews</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">COUNT</span><span class="o">,</span> <span class="s">"Number of documents to create"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">INTEGER</span><span class="o">).</span><span class="na">required</span><span class="o">().</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
        <span class="n">Number</span> <span class="n">countValue</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">COUNT</span><span class="o">);</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">countValue</span><span class="o">.</span><span class="na">intValue</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">SnapDataException</span> <span class="n">snapDataException</span> <span class="o">=</span>
                    <span class="k">new</span> <span class="nf">SnapDataException</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Invalid count value %d"</span><span class="o">,</span> <span class="n">count</span><span class="o">))</span>
                            <span class="o">.</span><span class="na">withReason</span><span class="o">(</span><span class="s">"Value of count property cannot be negative"</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">withResolution</span><span class="o">(</span><span class="s">"Ensure the count property is greater than or equal "</span> <span class="o">+</span>
                                    <span class="s">"to zero"</span><span class="o">);</span>
            <span class="n">errorViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">snapDataException</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">));</span>
            <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="c1">// NOOP</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>DocGenerator</code> Snap is similar to the <a href="#basic-snap-implementation"><code>SingleDocGenerator</code></a> Snap, except the number of documents generated is configurable through user input:</p>

<p><img src="images/lJqe.png" alt="Doc Generator" /></p>

<aside class="success">
All Snaps will have a required <strong>Label</strong> property for customizing the display label of the Snap within a Pipeline.
</aside>

<p>To accept user input, the <code>defineProperties</code> method is used.</p>

<p><a href="#snap-anatomy-101">As described earlier</a>, <code>defineProperties</code> is called when the Snap is being built. It constructs the Snap Schema which the Designer UI interprets and assembles into the Snap&#39;s Settings tab.</p>

<p>In <code>DocGenerator.defineProperties()</code>, a required <code>count</code> property of type <code>SnapType.INTEGER</code> is described and added to the provided <code>PropertyBuilder</code> instance.</p>

<p>Once the user has input their data and the Snap is executing, the <code>configure</code> method can access the data through the provided <code>PropertyValues</code> instance. As shown, this could be stored in an instance variable and used in the Snap&#39;s <code>execute()</code> method.</p>

<p>See the <a href="#propertybuilder-reference">PropertyBuilder Reference</a> section for more examples.</p>
<h2 id='validating-user-input'>Validating User Input</h2>
<p>The SnapLogic Platform will attempt to provide some basic type validation on user input:</p>

<p><img src="images/mi8k.png" alt="Auto validation" /></p>

<p>If more advanced validation is required, provide the implementation in the <code>configure</code> method and throw a <code>ConfigurationException</code> when invalid input is encountered. See <a href="#exceptions-and-error-views">Exceptions and Error Views</a> for more.</p>
<h2 id='expression-enabled-properties'>Expression-enabled Properties</h2><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocGenerator</span> <span class="kd">implements</span> <span class="n">Snap</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COUNT</span> <span class="o">=</span> <span class="s">"count"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Document</span> <span class="n">NO_DOCUMENT</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">DocumentUtility</span> <span class="n">documentUtility</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">OutputViews</span> <span class="n">outputViews</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">COUNT</span><span class="o">,</span> <span class="s">"Number of documents to create"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">INTEGER</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">expression</span><span class="o">()</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
        <span class="n">ExpressionProperty</span> <span class="n">countValueExp</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">COUNT</span><span class="o">);</span>

        <span class="c1">// evaluate the expression directly (without the context of a Document)</span>
        <span class="n">BigInteger</span> <span class="n">countValue</span> <span class="o">=</span> <span class="n">countValueExp</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="n">NO_DOCUMENT</span><span class="o">);</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">countValue</span><span class="o">.</span><span class="na">intValue</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">));</span>
            <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Snaplogic&#39;s <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1438042/Expression+Language+Overview">Expression Language</a> is an incredibly powerful tool available to Snaps. Using a JavaScript-like syntax, users have access to functions and properties to dynamically set property values.</p>

<p>Comparing to the <a href="#accepting-user-input-with-propertybuilder">previous implementation</a> of <code>DocGenerator</code>, we can see that <code>.expression()</code> has been added to the <code>propertyBuilder()</code>. </p>

<p>The <code>configure</code> method&#39;s <code>BigInteger countValue</code> local variable has been replaced by the <code>ExpressionProperty countValueExp</code> local variable, which is retrieved from the <code>PropertyValues</code> with the <code>getAsExpression</code> method, passing the field name &quot;count&quot; in. The <code>countValueExp</code> expression property is evaluated against <code>null</code> (as there is no incoming document to evaluate against e.g. when referencing a key in the incoming document), so the expression is evaluated directly. Since a number value was evaluated, we assign it to a local variable of type <code>BigInteger</code>, and then get its <code>intValue()</code>.</p>

<p>Within <code>execute()</code>, we can then use the <code>count</code> in the loop.</p>

<p>To demonstrate this new capability, we can use a &quot;count&quot; <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1438254/Pipeline+Properties">Pipeline Property</a> and then reference this in the Snap within a <code>parseInt</code> expression function:</p>

<p><img src="images/Zin9.png" alt="Doc Generator with Expression" /></p>

<p>For <a href="#propertybuilder-reference">composite and table properties</a>, the <code>getExpressionPropertyFor()</code> method can be used to evaluate child properties embedded in a parent. See <a href="https://github.com/SnapLogic/DemoSnapPack/blob/master/src/main/java/com/snaplogic/snaps/PropertyTypes.java#L136">this example provided in the reference DemoSnapPack GitHub repository</a>.</p>
<h2 id='suggesting-property-values'>Suggesting Property Values</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * This Snap has one output and writes one document that contains the suggested
 * value.
 *
 * &lt;p&gt;This snap demonstrates the suggest value functionality that uses the
 * partial configuration information to suggest a property value.&lt;/p&gt;
 */</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Suggest"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Demo suggest functionality."</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Suggest</span> <span class="kd">implements</span> <span class="n">Snap</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PROP_NAME</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PROP_ECHO</span> <span class="o">=</span> <span class="s">"echo"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">valueToWrite</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">DocumentUtility</span> <span class="n">documentUtility</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">OutputViews</span> <span class="n">outputViews</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">PROP_NAME</span><span class="o">,</span> <span class="n">PROP_NAME</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">PROP_ECHO</span><span class="o">,</span> <span class="n">PROP_ECHO</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withSuggestions</span><span class="o">(</span><span class="k">new</span> <span class="n">Suggestions</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">suggest</span><span class="o">(</span><span class="n">SuggestionBuilder</span> <span class="n">suggestionBuilder</span><span class="o">,</span>
                            <span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">PropertyCategory</span><span class="o">.</span><span class="na">SETTINGS</span><span class="o">,</span> <span class="n">PROP_NAME</span><span class="o">);</span>
                        <span class="n">suggestionBuilder</span><span class="o">.</span><span class="na">node</span><span class="o">(</span><span class="n">PROP_ECHO</span><span class="o">).</span><span class="na">suggestions</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}).</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
        <span class="n">valueToWrite</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">PROP_ECHO</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{{</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="n">valueToWrite</span><span class="o">);</span>
        <span class="o">}};</span>
        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="c1">// NOOP</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>A Snap can make &quot;suggestions&quot; to the user about property values. This is useful to lookup appropriate values using either another data source or the input value of a different property.</p>

<p>In the &quot;Suggest&quot; sample Snap, the user enters in a value for the &quot;name&quot; property. The &quot;echo&quot; property&#39;s suggest action then reads that value and allows the user to select it.</p>

<p><img src="images/e2S6.png" alt="Suggest" /></p>

<p>The suggest capability is enabled through use of the the <code>PropertyBuilder.withSuggestions(Suggestions suggestions)</code> method. Implementations of the <code>Suggestions</code> interface should be provided to it.</p>

<aside class="notice">
Notice that the UI also added the <strong>"="</strong> expression toggle button - suggestible properties <a href="#expression-enabled-properties">should always be expression-enabled too</a>. 

This was not done in the <code>Suggest</code> example above. The work required to support expressions for the field is left as an exercise to the reader.
</aside>

<p>The <code>Suggestions</code> instance (often an anonymous instance) implements the single <code>suggest</code> method. It provides, as method arguments, references to the <code>SuggestionBuilder</code> and the <code>PropertyValues</code>. </p>

<p>Using the <code>SuggestionBuilder</code> instance, we can configure simple String varargs for <code>suggestions()</code> for a selected <code>node()</code> that will result in a list of suggested values.</p>

<aside class="success">
Alternatively, use <code>objectSuggestions()</code> to add a list of values, with each entry representing a suggestion. The entry must be a map which provides a <strong>"label"</strong> key.

The label will be displayed by the UI as the selectable entry, the rest of the object definition will be hidden.
</aside>
<h3 id='suggestions-within-tables-and-composites'>Suggestions within Tables and Composites</h3>
<p>To add suggestions to a Table element property, select the table node and use the <code>over()</code> builder method:</p>

<div class="inline-code">
SnapProperty echo = propertyBuilder.describe(PROP_ECHO, PROP_ECHO)
    .type(SnapType.STRING)
    .withSuggestions(new Suggestions() {
        @Override
        public void suggest(SuggestionBuilder suggestionBuilder, 
                PropertyValues propertyValues) {
            suggestionBuilder
                .node("table")
                .over("echo")
                .suggestions("X", "Y");
        }
    }).build();

propertyBuilder.describe("table", "table")
    .type(SnapType.TABLE)
    .withEntry(echo)
    .add();
</div>

<p><img src="images/NlQw.png" alt="Table Suggest" /></p>

<aside class="warning">
Suggestions are not supported within Composite properties.
</aside>
<h2 id='input-output-view-schemas'>Input/Output View Schemas</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * A Pass-through Snap to provide schema on its input and output view.
 * If the incoming document matches the expected schema, document is written
 * to the output view. If the document does not match the schema, it is written
 * to the error view.
 */</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"View Schema"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Demonstrates view schema definition"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Errors</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">TRANSFORM</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchemaExample</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="kd">implements</span> <span class="n">InputSchemaProvider</span><span class="o">,</span>
        <span class="n">OutputSchemaProvider</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COL_A</span> <span class="o">=</span> <span class="s">"colA"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COL_B</span> <span class="o">=</span> <span class="s">"colB"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COL_C</span> <span class="o">=</span> <span class="s">"colC"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">INPUT_VIEW_NAME</span> <span class="o">=</span> <span class="s">"input0"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">OUTPUT_VIEW_NAME</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineInputSchema</span><span class="o">(</span><span class="kd">final</span> <span class="n">SchemaProvider</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Schema</span> <span class="n">colA</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="n">COL_A</span><span class="o">);</span>
        <span class="n">Schema</span> <span class="n">colB</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="n">COL_B</span><span class="o">);</span>
        <span class="n">Schema</span> <span class="n">colC</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="n">COL_C</span><span class="o">);</span>
        <span class="n">provider</span><span class="o">.</span><span class="na">getSchemaBuilder</span><span class="o">(</span><span class="n">INPUT_VIEW_NAME</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChildSchema</span><span class="o">(</span><span class="n">colA</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChildSchema</span><span class="o">(</span><span class="n">colB</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChildSchema</span><span class="o">(</span><span class="n">colC</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineOutputSchema</span><span class="o">(</span><span class="n">SchemaProvider</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Schema</span> <span class="n">colA</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="n">COL_A</span><span class="o">);</span>
        <span class="n">Schema</span> <span class="n">colB</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="n">COL_B</span><span class="o">);</span>
        <span class="n">Schema</span> <span class="n">colC</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="n">COL_C</span><span class="o">);</span>
        <span class="n">provider</span><span class="o">.</span><span class="na">getSchemaBuilder</span><span class="o">(</span><span class="n">OUTPUT_VIEW_NAME</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChildSchema</span><span class="o">(</span><span class="n">colA</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChildSchema</span><span class="o">(</span><span class="n">colB</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChildSchema</span><span class="o">(</span><span class="n">colC</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">inputViewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Validate incoming data against the schema</span>
        <span class="n">validate</span><span class="o">(</span><span class="n">document</span><span class="o">);</span>
        <span class="c1">// Pass the document to the downstream Snap in the pipeline.</span>
        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">document</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">COL_A</span><span class="o">,</span> <span class="n">COL_B</span><span class="o">,</span> <span class="n">COL_C</span><span class="o">})</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">content</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// Throwing a SnapDataException instructs the SnapLogic platform</span>
                <span class="c1">// to forward this document to the error view with the</span>
                <span class="c1">// provided error message.</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SnapDataException</span><span class="o">(</span><span class="n">document</span><span class="o">,</span>
                        <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Data map does not contain key:%s"</span><span class="o">,</span> <span class="n">key</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Snap View Schemas allow Snaps to declare the structure of the data they are expecting to consume and/or generate. </p>

<p>When understanding how to use a Schema, you must first understand how declaring an input or output schema affects the Snaps in the pipeline immediately preceding and following, respectively.</p>

<p>A Snap&#39;s input view schema becomes the Target Schema of the Snap (e.g. Mapper) immediately preceding it in the pipeline. This allows the user the opportunity to shape the data to the desired form:</p>

<p><img src="images/M3WA.png" alt="Input Schema" /></p>

<p>In the <code>SchemaExample</code> sample (which creates the <strong>&quot;View Schema&quot;</strong> Snap), an input schema is declared by implementing the <code>InputSchemaProvider</code> interface. This interface has a <code>defineInputSchema</code> method, where the <code>SchemaProvider</code> argument can be used to create child schemas and add them to the provider through a <code>SchemaBuilder</code>.</p>

<p>Similarly the Snap&#39;s output view schema becomes the Input Schema of the Snap immediately following it in the pipeline, allowing users to anticipate the shape of the data exiting the Snap:</p>

<p><img src="images/gqxF.png" alt="Output Schema" /></p>
<h3 id='enforcing-a-schema'>Enforcing a Schema</h3>
<p>Defining the schema as above will aid users in understanding what should be the structure of the data entering and exiting the Snap. However, the Snap will not reject data that does not conform to the schema.</p>

<p>If you wish to be strict about enforcing a schema, then you may provide your own validation of the input and output data during <code>execute</code>/<code>process</code>.</p>

<p>In the <code>SchemaExample</code> sample above, the <code>validate</code> method is called before the data is written to the output view. It checks that the incoming document has the properties declared in the schema present (<code>colA</code>, <code>colB</code>, and <code>colC</code>).</p>

<p>If the input data contains those keys, the document is written to the output view:</p>

<p><img src="images/fiAa.png" alt="Valid Input" /></p>

<p>If the input data does not contain all of those keys, a <code>SnapDataException</code> is thrown and the document is written to the error view:</p>

<p><img src="images/f4sZ.png" alt="Invalid Input" /></p>
<h2 id='exceptions-and-error-views'>Exceptions and Error Views</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>

<span class="cm">/**
 * This is the root exception for the jsdk module.
 *
 * All the other exceptions in jsdk module should derive from this exception. This exception
 * should not be used directly by the Snap author. Snap author should use
 * {@link com.snaplogic.api.ConfigurationException} or
 * {@link com.snaplogic.api.ExecutionException}
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SnapException</span> <span class="kd">extends</span> <span class="n">RuntimeException</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">reason</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">resolution</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Pattern</span> <span class="n">STACK_TRACE_PATTERN</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"\n[ \t]*at[ \t]+"</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">SnapException</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">stripStackTrace</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">SnapException</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">String</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">reason</span> <span class="o">=</span> <span class="n">stripStackTrace</span><span class="o">(</span><span class="n">reason</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">SnapException</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">initCause</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">SnapException</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">cause</span><span class="o">,</span> <span class="n">stringFormat</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">params</span><span class="o">));</span>
        <span class="k">this</span><span class="o">.</span><span class="na">reason</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Applies the given parameter values to the message template string.
     */</span>
    <span class="kd">public</span> <span class="n">SnapException</span> <span class="nf">formatWith</span><span class="o">(</span><span class="n">Object</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">getMessage</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">stripStackTrace</span><span class="o">(</span><span class="n">stringFormat</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">params</span><span class="o">));</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="o">...</span>
    <span class="cm">/**
     * Sets the exception message for the user.
     */</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">SnapException</span><span class="o">&gt;</span> <span class="n">T</span>  <span class="nf">withReason</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">reason</span> <span class="o">=</span> <span class="n">stripStackTrace</span><span class="o">(</span><span class="n">reason</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Sets the resolution for fixing this exception.
     */</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">SnapException</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">withResolution</span><span class="o">(</span><span class="n">String</span> <span class="n">resolution</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="n">stripStackTrace</span><span class="o">(</span><span class="n">resolution</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">SnapException</span><span class="o">&gt;</span> <span class="n">T</span>  <span class="nf">withResolutionAsDefect</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="na">PLEASE_FILE_A_DEFECT_AGAINST_SNAP</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="o">...</span>
</code></pre>
<p><code>SnapException</code> is the root exception type and extends <code>RuntimeException</code>. However, you should instead use one of the following implementations instead:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Where to Use</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>ConfigurationException</code></td>
<td><code>configure()</code></td>
<td>Throw when the Snap&#39;s settings are invalid.</td>
</tr>
<tr>
<td><code>ExecutionException</code></td>
<td><code>execute()</code></td>
<td>Throw for internal, non-data-related ex errors.</td>
</tr>
<tr>
<td><code>SnapDataException</code></td>
<td><code>execute()</code></td>
<td>Throw for data-related errors.</td>
</tr>
</tbody></table>

<aside class="notice">
If your Snap extends <code>SimpleSnap</code>, thrown <code>SnapDataException</code>s will be automatically written to the error view.
</aside>
<h3 id='constructing-exceptions'>Constructing Exceptions</h3>
<p>At it&#39;s most basic, a <code>SnapException</code> subclass instance just requires a failure message to be communicated to the user:</p>

<div class="inline-code">
@Override
public void execute() throws ExecutionException {
    throw new ExecutionException("Message");
}
</div>

<p>This results in the following user experience:</p>

<p><img src="images/eX3K.png" alt="Basic Exception" /></p>

<p>When creating exceptions, we recommend providing a failure message, a reason, and a resolution:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Message</td>
<td>High level explanation of the issue (what was the Snap trying to do).</td>
</tr>
<tr>
<td>Reason</td>
<td>Detailed explanation of the issue (defaults to the root cause message).</td>
</tr>
<tr>
<td>Resolution</td>
<td>What can the user do to fix the issue</td>
</tr>
</tbody></table>

<div class="inline-code">
@Override
public void execute() throws ExecutionException {
    String deptName = "deptName";

    String message = "The \"%s\" field was missing.";
    String reason = "This Snap requires all fields to be present in the data source.";
    String resolution = String.format("Contact your DBA to ensure all model fields " +
            "are present in the data source.", deptName);

    throw new ExecutionException(message)
        .formatWith(deptName)
        .withReason(reason)
        .withResolution(resolution);
}       
</div>

<p><img src="images/FjIr.png" alt="Reason and Resolution" /></p>
<h3 id='configurationexception'>ConfigurationException</h3>
<p><code>ConfigurationException</code> instances should be thrown during <code>configure()</code>, when the pipeline is validating:</p>

<div class="inline-code">
@Override
public void configure(PropertyValues propertyValues) throws ConfigurationException {
    throw new ConfigurationException("Error Message for User")
        .withReason("A good reason.")
        .withResolution("What to do next.");
}
</div>

<p><img src="images/JAB9.png" alt="Config Exception" /></p>
<h3 id='writing-exceptions-to-the-error-view'>Writing Exceptions to the Error View</h3>
<p>Throwing a new <code>SnapDataException</code> and writing it to the error view along with the input document that generated the data error, will display both the exception stacktrace and the original data. For example:</p>

<div class="inline-code">
@Override
public void execute() throws ExecutionException {
    try {
        throw new IllegalArgumentException("Illegal Argument.");
    } catch (IllegalArgumentException e) {
        SnapDataException snapDataException = new SnapDataException(e, "Error Message.")
            .withResolution("Provide the correct argument.");

        errorViews.write(snapDataException, document);
    }
}
</div>

<p>will result in the following content written to the error view:</p>

<p><img src="images/DmKE.png" alt="Error View Exception" /></p>

<p>If your Snap extends <code>SimpleSnap</code>, it is even easier - just throw the <code>SnapDataException</code> and it will be written to the error view as above:</p>

<div class="inline-code">
@Override
public void process(Document document, String inputViewName) throws ExecutionException {
    try {
        throw new IllegalArgumentException("Illegal Argument.");
    } catch (IllegalArgumentException e) {
        throw new SnapDataException(e, "Error Message.")
            .withResolution("Provide the correct argument.");
    }
}
</div>

<aside class="success">
SnapLogic recommends always enabling a Document error view:

<p><code>@Errors(min = 1, max = 1, offers = {ViewType.DOCUMENT})</code></p>
</aside>
<h2 id='customizing-input-output-views'>Customizing Input/Output Views</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * This Snap demonstrates two inputs and two outputs.
 *
 * &lt;p&gt;To use it, feed it parents.json and children.json. It will output two streams,
 * one for only males and another for females. Unknowns will get sent to both.&lt;/p&gt;
 */</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Two Ins/Outs"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Accepts two inputs, sends to two outputs."</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwoInputsTwoOutputs</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="kd">implements</span> <span class="n">ViewProvider</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">TwoInputsTwoOutputs</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">INPUT_0</span> <span class="o">=</span> <span class="s">"input0"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">INPUT_1</span> <span class="o">=</span> <span class="s">"input1"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">MALE_VIEW</span> <span class="o">=</span> <span class="s">"output_male"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">FEMALE_VIEW</span> <span class="o">=</span> <span class="s">"output_female"</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">OutputViews</span> <span class="n">outputViews</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ErrorViews</span> <span class="n">errorViews</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineViews</span><span class="o">(</span><span class="kd">final</span> <span class="n">ViewBuilder</span> <span class="n">viewBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">viewBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">INPUT_0</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ViewCategory</span><span class="o">.</span><span class="na">INPUT</span><span class="o">);</span>
        <span class="n">viewBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">INPUT_1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ViewCategory</span><span class="o">.</span><span class="na">INPUT</span><span class="o">);</span>

        <span class="n">viewBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">MALE_VIEW</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ViewCategory</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">);</span>
        <span class="n">viewBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">FEMALE_VIEW</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ViewCategory</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="cm">/*
     * process gets called for every document
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">String</span> <span class="n">inputViewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Document</span> <span class="n">newdoc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">newdoc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// Add a new field "processed" that is set to value - TRUE</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"processed"</span><span class="o">,</span> <span class="s">"True"</span><span class="o">);</span>

        <span class="c1">// send males to male output view</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"gender"</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">"male"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">outputViews</span><span class="o">.</span><span class="na">getDocumentViewFor</span><span class="o">(</span><span class="n">MALE_VIEW</span><span class="o">).</span><span class="na">write</span><span class="o">(</span><span class="n">newdoc</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"gender"</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">"female"</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// send females to female output view</span>
             <span class="n">outputViews</span><span class="o">.</span><span class="na">getDocumentViewFor</span><span class="o">(</span><span class="n">FEMALE_VIEW</span><span class="o">).</span><span class="na">write</span><span class="o">(</span><span class="n">newdoc</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// send unknowns to error views</span>
             <span class="n">errorViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">newdoc</span><span class="o">,</span> <span class="n">document</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p>The <code>TwoInputsTwoOutputs</code> sample accepts documents from two input views and routes to a particular output view based on the value of the &quot;gender&quot; field:</p>

<p><img src="images/oHpC.png" alt="TwoInOut" /></p>
<h3 id='reading-from-multiple-input-views'>Reading from Multiple Input Views</h3>
<p>As it extends <code>SimpleSnap</code>, the &quot;Two Ins/Outs&quot; Snap benefits from already knowing how to read from multiple input views. <code>ExecutionUtil</code> iterates over the available input views and send each document to the <code>process()</code> method, <a href="#bootstrapping-with-simplesnap">as shown previously</a>. If you can guarantee that each input view will have documents sent to it, this is an acceptable solution. </p>

<aside class="success">
If you cannot guarantee that all input views will be written to, use <code>InputViews.select()</code> to poll the input views in a non-blocking manner. SnapLogic recommends this approach for most multiple-input view scenarios.
</aside>
<h3 id='configuring-optional-views'>Configuring Optional Views</h3>
<p>It is rarely a good idea to prevent either an input or an output view for a Snap. For one, it prevents using that Snap as unlinked input at the beginning of <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1439408/Tasks+Page">a Task pipeline</a>, and restricts its ability to be used mid-pipeline.</p>

<p>However, if you wish to allow the user to remove all input and output views, it&#39;s best to declare the views as optional, to open them by default, and then have the user remove them through the <strong>Views</strong> tab of the Snap.</p>

<p>This can be done by implementing the <code>ViewProvider</code> interface and using the <code>defineViews()</code> method&#39;s <code>ViewBuilder</code> argument:</p>

<div class="inline-code">
@Inputs(min = 0, max = 2, accepts = {ViewType.DOCUMENT})
@Outputs(min = 0, max = 2, offers = {ViewType.DOCUMENT})
...
// this creates the two open input views and the two named output views
@Override
public void defineViews(final ViewBuilder viewBuilder) {
    viewBuilder.describe(INPUT_0)
            .type(ViewType.DOCUMENT)
            .add(ViewCategory.INPUT);
    viewBuilder.describe(INPUT_1)
            .type(ViewType.DOCUMENT)
            .add(ViewCategory.INPUT);

    viewBuilder.describe(MALE_VIEW)
            .type(ViewType.DOCUMENT)
            .add(ViewCategory.OUTPUT);
    viewBuilder.describe(FEMALE_VIEW)
            .type(ViewType.DOCUMENT)
            .add(ViewCategory.OUTPUT);
}
</div>

<p><img src="images/nFE8.png" alt="Remove Views" /></p>
<h3 id='writing-to-multiple-output-views'>Writing to Multiple Output Views</h3>
<p><code>OutputViews.getDocumentViewFor(viewName)</code> can be used to return the document output view for the given view name:</p>

<div class="inline-code">
// send males to male output view
if (data.get("gender").equals("male")) {
    outputViews.getDocumentViewFor(MALE_VIEW).write(newdoc);
} else if (data.get("gender").equals("female")) {
    // send females to female output view
    outputViews.getDocumentViewFor(FEMALE_VIEW).write(newdoc);
} else {
    // send unknowns to error views
    errorViews.write(newdoc, document);
}
</div>
<h2 id='pipeline-validation-preview-specific-behavior'>Pipeline Validation/Preview-specific Behavior</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>
<span class="o">...</span>
<span class="cm">/**
 * This interface provides a way to implement the configuration and the execution
 * of the snap for Preview/Validation (formerly known as "Suggest" action).
 *
 * NOTE: This interface is not mandatory to implement for a Snap author.
 *
 * If implemented, the &lt;code&gt;configureForSuggest&lt;/code&gt; method will be called in place of the
 * &lt;code&gt;configure&lt;/code&gt; method of the Snap interface and the &lt;code&gt;executeForSuggest&lt;/code&gt;
 * method will be called in place of &lt;code&gt;execute&lt;/code&gt; method of the Snap interface during
 * Preview/Validation.
 *
 * If not implemented, the &lt;code&gt;configure&lt;/code&gt; and the &lt;code&gt;execute&lt;/code&gt; methods of the
 * snap interface will be called during Preview/Validation.
 *
 * Usecase: A JMS consumer snap
 *
 * The JMS consumer indefinitely polls for the messages to arrive during the execution of the
 * snap. This situation is not desirable for the Suggest/Save action as it will never complete.
 * In addition, we also don't want to remove messages from the destination for the Suggest/Save
 * action by acknowledging them.
 *
 * Hence, the snap author may implement the interface as following:
 * &lt;code&gt;
 *     ...
 *
 *     public void configure(PropertyValues propertyValues) throws ConfigurationException {
 *         ...
 *     }
 *
 *     public void configureForSuggest(PropertyValues propertyValues)
 *              throws ConfigurationException {
 *         // Fetch all the property values EXCEPT Acknowledgment mode.
 *         // Lookup for ConnectionFactory and Destination objects.
 *         // Create Connection object using the above ConnectionFactory
 *         // Create Session object using Session.CLIENT_ACKNOWLEDGE as an acknowledgment mode
 *     }
 *
 *     public void execute() throws ExecutionException {
 *         ...
 *     }
 *
 *     public void executeForSuggest() throws ExecutionException {
 *         try {
 *             Message message = consumer.receive(5000);
 *             if (message != null) {
 *                 processMessage(message);
 *                 // Don't acknowledge the message so that it does't
 *                 // get removed from the destination
 *             }
 *         } catch (JMSException e) {
 *             // Handle the exception
 *         }
 *
 *     }
 *     ...
 * &lt;/code&gt;
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SuggestExecutionProvider</span> <span class="o">{</span>
    <span class="cm">/**
     * This method will be called for the Snap configuration during Suggest
     *
     * @param propertyValues
     * @param maxSuggestValue as the maximum of rows/time being read
     */</span>
    <span class="kt">void</span> <span class="nf">configureForSuggest</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">,</span>
            <span class="n">BigInteger</span> <span class="n">maxSuggestValue</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span><span class="o">;</span>

    <span class="cm">/**
     * This method will be called for the Snap execution during Suggest
     */</span>
    <span class="kt">void</span> <span class="nf">executeForSuggest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
<p>If pipeline validation is enabled and the user saves the pipeline in the Designer, the SnapLogic Platform attempts to validate the pipeline and displays preview data between Snaps.</p>

<p>When validating the pipeline, the Platform will attempt to limit the amount of data processed (for example, up to 50 input documents) as it is not a full pipeline execution but rather a tool to give visual feedback on the data as it flows through the pipeline.</p>

<p>If your Snap wishes to customize its behaviour during pipeline, it can implement the <code>SuggestExecutionProvider</code> interface.</p>

<aside class="notice">
"Suggest" is the legacy name for the Pipeline Validation and Preview feature and not related to <a href="#suggesting-property-values">the current Property Suggest feature</a> in a Snap's Settings. Our apologies for any confusion this will cause.
</aside>

<p>As per the JavaDocs of <code>SuggestExecutionProvider</code>, implementing the <code>configureForSuggest()</code> and <code>executeForSuggest()</code> methods can trigger specific behavior during Snap configuration and execution when the pipeline is being validated.</p>

<p>A thrown <code>SuggestViewAbortException</code> can indicate that the pipeline validation/preview-specific behavior threshold has been reached.</p>
<h2 id='dependency-injection'>Dependency Injection</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * A basic example of a Snap that converts amount values from USD to another currency.
 */</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Currency Converter"</span><span class="o">,</span> <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span>
        <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Demonstrates dependency injection"</span><span class="o">,</span>
        <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CurrencyConverter</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="kd">implements</span> <span class="n">DependencyManager</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">INPUT_FILE_PROP</span> <span class="o">=</span> <span class="s">"inputFile"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">filePath</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TypeReference</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">mapTypeReference</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">TypeReference</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
            <span class="o">};</span>

    <span class="c1">// the SnapLogic platform takes care of injecting an ObjectMapper instance</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ObjectMapper</span> <span class="n">mapper</span><span class="o">;</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ForEx</span> <span class="n">foreignExchange</span><span class="o">;</span>

    <span class="c1">// Use an instance of Guice's AbstractModule to bind implementations to interfaces</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Module</span> <span class="nf">getManagedModule</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">bind</span><span class="o">(</span><span class="n">ForEx</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">ForExImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>

    <span class="c1">// An optional file selector for providing exchange rates within a file</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">INPUT_FILE_PROP</span><span class="o">,</span> <span class="s">"Exchange Rates File"</span><span class="o">,</span>
                <span class="s">"File containing foreign exchange rates"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">expression</span><span class="o">()</span>
                <span class="o">.</span><span class="na">fileBrowsing</span><span class="o">()</span>
                <span class="o">.</span><span class="na">schemaAware</span><span class="o">(</span><span class="n">SnapProperty</span><span class="o">.</span><span class="na">DecoratorType</span><span class="o">.</span><span class="na">ACCEPTS_SCHEMA</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">INPUT_FILE_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">String</span> <span class="n">inputViewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">docAsMap</span> <span class="o">=</span> <span class="n">documentUtility</span><span class="o">.</span><span class="na">getAsMap</span><span class="o">(</span><span class="n">document</span><span class="o">,</span> <span class="n">errorViews</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">targetCurrency</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">docAsMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"to"</span><span class="o">);</span>
        <span class="n">BigDecimal</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(((</span><span class="n">Number</span><span class="o">)</span> <span class="n">docAsMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"amount"</span><span class="o">)).</span><span class="na">doubleValue</span><span class="o">());</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">exchangeRates</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// If a file was provided, use the exchange rates within it; otherwise, look them up from</span>
        <span class="c1">// the service</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">filePath</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">exchangeRates</span> <span class="o">=</span> <span class="n">getExchangeRatesFromFile</span><span class="o">(</span><span class="n">document</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">exchangeRates</span> <span class="o">=</span> <span class="n">foreignExchange</span><span class="o">.</span><span class="na">getExchangeRates</span><span class="o">(</span><span class="n">targetCurrency</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">exchangeRates</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span>
                    <span class="n">getExchangeRateForCurrency</span><span class="o">(</span><span class="n">targetCurrency</span><span class="o">,</span> <span class="n">amount</span><span class="o">,</span> <span class="n">exchangeRates</span><span class="o">)),</span> <span class="n">document</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getExchangeRatesFromFile</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">exchangeRates</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">filePath</span><span class="o">).</span><span class="na">openStream</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">exchangeRates</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">inputStream</span><span class="o">,</span> <span class="n">mapTypeReference</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">SnapDataException</span><span class="o">(</span><span class="n">document</span><span class="o">,</span> <span class="n">e</span><span class="o">,</span>
                    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Unable to read from file path %s"</span><span class="o">,</span> <span class="n">filePath</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">exchangeRates</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">&gt;</span> <span class="nf">getExchangeRateForCurrency</span><span class="o">(</span><span class="n">String</span> <span class="n">targetCurrency</span><span class="o">,</span>
            <span class="n">BigDecimal</span> <span class="n">amount</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">rate</span><span class="o">)</span> <span class="o">{</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">forExRates</span> <span class="o">=</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;)</span> <span class="n">rate</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"rates"</span><span class="o">);</span>
        <span class="n">BigDecimal</span> <span class="n">forExRate</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span>
                <span class="o">((</span><span class="n">Number</span><span class="o">)</span> <span class="n">forExRates</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">targetCurrency</span><span class="o">)).</span><span class="na">doubleValue</span><span class="o">());</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">&gt;</span> <span class="n">convertedCurrency</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">convertedCurrency</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">targetCurrency</span><span class="o">,</span> <span class="n">amount</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">forExRate</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">convertedCurrency</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ForEx</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getExchangeRates</span><span class="o">(</span><span class="n">String</span> <span class="n">currencyCode</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// An implementation of the ForEx interface. Normally this would call out to a database or</span>
    <span class="c1">// web service; in this demonstration, it returns random exchange rates.</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ForExImpl</span> <span class="kd">implements</span> <span class="n">ForEx</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">rate</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ForExImpl</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getExchangeRates</span><span class="o">(</span><span class="n">String</span> <span class="n">currencyCode</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">rate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"base"</span><span class="o">,</span> <span class="n">currencyCode</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">());</span>
            <span class="n">rate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"date"</span><span class="o">,</span> <span class="n">DateTimeFormat</span><span class="o">.</span><span class="na">forPattern</span><span class="o">(</span><span class="s">"yyyy-MM-dd"</span><span class="o">).</span><span class="na">print</span><span class="o">(</span><span class="n">now</span><span class="o">(</span><span class="n">UTC</span><span class="o">)));</span>

            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">&gt;</span> <span class="n">forExRates</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">Random</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
            <span class="n">forExRates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"AUD"</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()));</span>
            <span class="n">forExRates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"GBP"</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()));</span>
            <span class="n">forExRates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"EUR"</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()));</span>
            <span class="n">rate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"rates"</span><span class="o">,</span> <span class="n">forExRates</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">rate</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Snaps use Google&#39;s <a href="https://github.com/google/guice">Guice</a> library for dependency injection. </p>

<p>Snaps that implement the <code>DependencyManager</code> interface can return a <a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Module.html">Guice Module</a> that can configure interface bindings to be used by SnapLogic&#39;s <a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Injector.html">Injector</a>. </p>

<p>In the &quot;Currency Converter&quot; example shown, DependencyManager&#39;s <code>getManagedModule</code> method is implemented to return an <code>AbstractModule</code> instance, with the <code>ForEx</code> interface bound to the <code>ForExImpl</code> implementation.</p>

<p>This allows taking advantage of the <a href="https://www.martinfowler.com/articles/injection.html">&quot;inversion of control&quot;</a> software design pattern to provide different implementations of a service interface for a hierarchy of related Snaps.</p>

<p>It also greatly benefits unit testing, since it permits injecting in stub or mock versions of service dependencies; see the <code>CurrencyConverterTest</code> test class for more.</p>
<h2 id='handling-pipeline-lifecycle-events'>Handling Pipeline Lifecycle Events</h2><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeSnap</span> <span class="kd">implements</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">LifecycleCallback</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">LifecycleEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nl">CLOSE:</span>
            <span class="k">case</span> <span class="nl">FAILURE:</span>
            <span class="k">case</span> <span class="nl">STOP:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Got a lifecycle event to stop the Snap's execution: {}"</span><span class="o">,</span>
                        <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">event</span><span class="o">));</span>
                <span class="c1">// perhaps set a volatile boolean</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">SUCCESS:</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Got the lifecycle event: {}"</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">event</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="o">...</span>

<span class="o">}</span>
</code></pre>
<p>Snaps can be notified of Pipeline Lifecyle events by implementing the <code>LifecycleEvent</code> interface. This can be especially useful when unexpected actions have been taken; for example, if a user manually stopped an executing pipeline causing a thread to be interrupted, a &quot;STOP&quot; <code>LifecycleEvent</code> can be handled by the Snap and some cleanup activities can be programmed. </p>

<aside class="notice">
<code>STOP</code> and <code>CLOSE</code> are asynchronous events that are delivered in a separate thread from the Snap thread. Consider using multithreaded-sensitive solutions e.g. <code>volatile</code> variables etc.
</aside>

<p>Implementing the interface requires providing an implementation for the <code>void handle(final LifecycleEvent event)</code> method. <code>LifecycleEvent</code> is an enum with the following values:</p>

<table><thead>
<tr>
<th>Lifecycle Event</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>CREATE</td>
<td>Event that happens when an instance of the Snap is created.</td>
</tr>
<tr>
<td>CONFIGURE</td>
<td>Event that happens when the Snap is configured with the user provided property values before execution</td>
</tr>
<tr>
<td>START</td>
<td>Event that happens when the Snap execution starts.</td>
</tr>
<tr>
<td>CLOSE</td>
<td>Async event that is triggered when the pipeline needs to shutdown gracefully.<p />WARNING: This event is delivered in a thread separate from the Snap thread, so any changes to Snap state should be done carefully.</td>
</tr>
<tr>
<td>STOP</td>
<td>Async event that is triggered when the pipeline is stopped.<p />WARNING: This event is delivered in a thread separate from the Snap thread, so any changes to Snap state should be done carefully.</td>
</tr>
<tr>
<td>FAILURE</td>
<td>Event that happens when the Snap execution fails.</td>
</tr>
<tr>
<td>SUCCESS</td>
<td>Event that happens when the Snap execution completes successfully.</td>
</tr>
</tbody></table>
<h1 id='deploying-snap-packs'>Deploying Snap Packs</h1>
<p>Now that we understand how to build a Snap, let&#39;s see how to deploy it so it can be used within the SnapLogic Platform.</p>

<p>Snap Packs are Maven projects, so they benefit from rich tooling support on the terminal, within IDE plugins, and from Continuous Integration servers.</p>

<p>There are two ways to deploy a Snap Pack - one targeted for developers seeking rapid deployment during Snap development, the other for Organization admin and/or operational users to upload through the SnapLogic Manager UI.</p>
<h2 id='mvn-snappack-deploy'>mvn snappack:deploy</h2><pre class="highlight shell tab-shell"><code><span class="gp">$ </span><span class="nb">cd</span> <span class="nv">$SNAP_HOME</span>/demosnappack
<span class="gp">$ </span>mvn clean package
<span class="gp">$ </span>mvn snappack:deploy
</code></pre>
<p>The <a href="#snap-maven-archetype">Snap Archetype</a> POM includes the <code>snappack-installer</code> plugin which contains the <code>snappack:deploy</code> goal.</p>

<p>After building the Snap Pack with <code>mvn clean package</code>, the <code>snappack:deploy</code> goal POSTs the Snap Schema to endpoint associated to the <code>jcc.sldb_uri</code> property in <code>~/opt/snaplogic/etc/keys.properties</code>. </p>

<p>It will use the properties and credentials defined in the Snap&#39;s <code>pom.xml</code> and the <code>~/opt/snaplogic/etc/keys.properties</code> file respectively - it is imperative that they are configured correctly.</p>

<aside class="notice">
In a future release, these critical properties will also be readable from the `.slpropz` file.  At this time, the `.slpropz` file is not supported for the `snappack:deploy` goal.
</aside>

<p>By default, the binaries will not be deployed (it will look for the ZIP of JARs using the <code>$SNAP_HOME</code> environment variable) and will deploy to <a href="#project-structure">the <code>ASSET_DIR_PATH</code> specified in the <code>directives</code> file</a> in <em>src/main/config</em>.</p>
<h3 id='asset_path'>asset_path</h3>
<p>Use the <code>asset_path</code> parameter if you wish to override the value of the <code>ASSET_DIR_PATH</code> specified in the directives file e.g. <code>mvn snappack:deploy -Dasset_path=/snaplogic/shared</code>.</p>

<p>This can be a useful feature for Continuous Integration and Continuous Deployment tools.</p>
<h3 id='binaries'>binaries</h3>
<p>Use the <code>binaries</code> boolean parameter to permit the Snap to be executed on Snaplexes other than the development Snaplex configured earlier, you can instruct the goal to upload the ZIP of the Snap&#39;s JAR files (source and dependencies) to SLDB.</p>

<p><code>mvn snappack:deploy -Dbinaries=true</code></p>

<aside class="success">
We recommend using this Maven goal during Snap development, to be run on a development Snaplex, and to deploy to a dedicated development project folder or a Project Space, rather than your Organization's root shared directory.
<br />
<br />
While every effort has been made to ensure the stability of this feature, it is possible for it to upload versions in conflict with other versions of the Snap deployed through the Manager, or for other errors to occur. If that takes place, use the Manager UI Snap Pack ZIP upload method instead (see below).
</aside>
<h2 id='uploading-zip-file-through-manager-ui'>Uploading ZIP File through Manager UI</h2><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>ls -al ~/opt/snaplogic-dev/demosnappack/target/ | grep zip
-rw-r--r--   1 snapdev  staff  52588 Jul 21 01:46 demosnappack-1-0001.zip
</code></pre>
<p>After a <code>mvn clean install</code> execution, the Snap&#39;s <code>target</code> directory will contain a Snap Pack ZIP file containing the zipped source and dependency JARs of the Snap, the Snap and Account schema files, and a <code>MANIFEST</code>.</p>

<p>This ZIP file can then be uploaded through the Manager UI to the root/project folder/Project Space directory of your choice.</p>

<p><img src="images/WhVl.png" alt="Manager" /></p>

<aside class="success">
We recommended using this method of deployment when releasing a stable version of your custom Snap to your users, and when uploading to the Organization's root shared directory. Preferably, development versions of the Snap Pack should be deleted from development project folders and/or Project Spaces prior to this to avoid confusion.
<br />
<br />
In the near future, SnapLogic will update the <code>snappack:deploy</code> goal to upload the Snap Pack ZIP file to match this process.
</aside>
<h3 id='troubleshooting'>Troubleshooting</h3>
<p>The SnapLogic Platform will attempt to load the version of the Snap Pack associated with the pipeline&#39;s saved location, falling back to the Organization&#39;s root shared directory if needed.</p>

<p>If multiple versions of a custom Snap exist in different location, and with incompatible Snap Schemas, the Platform can experience issues if pipelines containing that custom Snaps are moved between the locations.</p>

<p>Also, always refresh the browser after uploading a new version of a Snap Pack containing Snap or Account Schema changes. If the problem persists, also consider deleting the entries in your browser&#39;s session storage:</p>

<p><img src="images/s45d.png" alt="Session Storage" /></p>

<p>If during local development your find your local Snaplex/JCC picking up Snap changes, stop and restart it.</p>
<h2 id='deploying-a-new-version'>Deploying a New Version</h2>
<p>When you&#39;ve made changes to your Snap Pack and wish to deploy a new version, it is important to use a new, unique value
for the <code>sl_build</code> property defined in the <code>pom.xml</code> file&#39;s <code>properties</code> section, which is initially set to <code>0001</code>.  You can
either update the value of this property in the file, or set it from the command-line when building your Snap Pack.</p>

<p>For example:</p>

<p><code>mvn clean package -Dsl_build=0002</code></p>

<p>Important: Avoid using a hyphen (<code>-</code>) in your <code>sl_build</code> value. </p>
<h1 id='authenticating-with-accounts'>Authenticating with Accounts</h1><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>

<span class="cm">/**
 * Interface for Account classes which can be used by Snap classes
 *
 * @param &lt;T&gt; as the return type for {@link #connect}
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Account</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * Defines the properties of the account using the provided {@link PropertyBuilder}
     * The property category is set to {@link PropertyCategory#ACCOUNT} and should not be
     * changed.
     *
     * @param propertyBuilder as the builder
     */</span>
    <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">);</span>

    <span class="cm">/**
     * Sets the property values on the account
     *
     * @param propertyValues as the property values
     */</span>
    <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">);</span>

    <span class="cm">/**
     * Allows to connect to the endpoint
     *
     * @return an optional value that might be needed to access the session
     * @throws ExecutionException
     */</span>
    <span class="n">T</span> <span class="nf">connect</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="o">;</span>

    <span class="cm">/**
     * Allows to disconnect from the endpoint
     *
     * @throws ExecutionException
     */</span>
    <span class="kt">void</span> <span class="nf">disconnect</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
<p>Snap Accounts allow the re-use of authentication credentials and properties across Snaps. </p>

<p>They also permit storing, encrypting, and obfuscating sensitive information like passwords, secret keys etc.</p>
<h2 id='account-configuration'>Account Configuration</h2><pre class="highlight java tab-java"><code><span class="cm">/**
 * Demonstrates Snap Accounts. Two security-sensitive properties, User ID and Passphrase, are used
 * to build a simple hash-token.
 *
 * &lt;p&gt;The User ID property is also made available to the Snap (through
 * the {@code account.userId} expression variable).&lt;/p&gt;
 */</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Example Snap Account"</span><span class="o">)</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@AccountCategory</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">AccountType</span><span class="o">.</span><span class="na">CUSTOM</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleAccount</span> <span class="kd">implements</span> <span class="n">Account</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;,</span> <span class="n">ValidatableAccount</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;,</span>
        <span class="n">AccountVariableProvider</span> <span class="o">{</span>

    <span class="kd">protected</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER_ID</span> <span class="o">=</span> <span class="s">"userId"</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PASSPHRASE</span> <span class="o">=</span> <span class="s">"passphrase"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">passphrase</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">,</span> <span class="s">"User ID"</span><span class="o">,</span> <span class="s">"ID of the user"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="c1">// for Enhanced Account Encryption; indicate to the SnapLogic Platform</span>
                <span class="c1">// that Medium/High Sensitivity-configured Organizations should encrypt</span>
                <span class="c1">// this data</span>
                <span class="o">.</span><span class="na">sensitivity</span><span class="o">(</span><span class="n">SnapProperty</span><span class="o">.</span><span class="na">SensitivityLevel</span><span class="o">.</span><span class="na">MEDIUM</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>

        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">PASSPHRASE</span><span class="o">,</span> <span class="s">"Passphrase"</span><span class="o">,</span> <span class="s">"The user's passphrase"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">obfuscate</span><span class="o">()</span> <span class="c1">// masks user's input and sets SensitivityLevel to HIGH</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Exercise: sanitize and validate</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
        <span class="n">passphrase</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">PASSPHRASE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">connect</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="cm">/*
        Return a String that conforms to this simple hash-token scheme:

        base64(userId + ":" + expirationTimestamp + ":" +
             md5(userId + ":" + expirationTimestamp + ":" passphrase))
         */</span>
        <span class="kt">long</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">getExpirationTimestamp</span><span class="o">();</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">md5</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">MessageDigest</span> <span class="n">md5MessageDigest</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"MD5"</span><span class="o">);</span>
            <span class="n">md5</span> <span class="o">=</span> <span class="n">md5MessageDigest</span><span class="o">.</span><span class="na">digest</span><span class="o">(</span>
                    <span class="o">(</span><span class="n">getUserId</span><span class="o">()</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">expiration</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">getPassphrase</span><span class="o">()).</span><span class="na">getBytes</span><span class="o">(</span><span class="n">UTF_8</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchAlgorithmException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ExecutionException</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="s">"Unable to get MD5 MessageDigest instance"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">withResolution</span><span class="o">(</span><span class="s">"Contact the Snap Developer"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="nf">encodeBase64String</span><span class="o">(</span>
                <span class="o">(</span><span class="n">userId</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">expiration</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">md5</span><span class="o">)).</span><span class="na">getBytes</span><span class="o">(</span><span class="n">UTF_8</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnect</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span> <span class="o">{</span>
        <span class="c1">// no-op</span>
    <span class="o">}</span>

    <span class="cm">/*
    Make account property values available to a Snap
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getAccountVariableValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ExpressionVariableAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="k">new</span> <span class="n">ImmutableSet</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;()</span>
                        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">,</span> <span class="n">getUserId</span><span class="o">()))</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">long</span> <span class="nf">getExpirationTimestamp</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getMillis</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p>At their most basic, Accounts will implement the <code>Account</code> interface and provide a Generic Type that is used as the return type of the <code>Account.connect()</code> method.</p>

<p>Similarly to Snaps, you may use the <code>defineProperties()</code> method to build the Settings tab UI, and the <code>configure()</code> method to bind/validate the user&#39;s input. </p>

<aside class="warning">
Unlike Snaps, you cannot <a href="#expression-enabled-properties">expression-enable</a> Account properties.
</aside>

<p><img src="images/fNOT.png" alt="Create Custom Account" /></p>

<aside class="success">
Remember to declare the new Account in the Snap POM's <code>&lt;account.classes&gt;</code> element e.g.
<br />
<br /><code><strong>&lt;account.classes&gt;com.snaplogic.snaps.ExampleAccount&lt;/account.classes&gt;</strong></code>
</aside>
<h3 id='encrypting-and-obfuscating-user-input'>Encrypting and Obfuscating User Input</h3>
<p>It can also be particular useful to mark particular properties as containing sensitive information and/or requiring input masking. </p>

<p>The <code>sensitivity()</code> builder method allows setting a <code>LOW</code>, <code>MEDIUM</code>, or <code>HIGH</code> <code>SensitivityLevel</code>, which instructs the SnapLogic Platform&#39;s <a href="https://docs-snaplogic.atlassian.net/wiki/spaces/SD/pages/1437994/Enhanced+Account+Encryption">Enhanced Account Encryption</a> feature to encrypt the marked account data.</p>

<p>The <code>obfuscate()</code> builder method masks user input and automatically sets the property to <code>SensitivityLevel.HIGH</code>.</p>
<h3 id='connecting-the-account'>Connecting the Account</h3>
<p>The <code>Account</code> interface also defines a <code>connect()</code> method (whose return type is determined by the <a href="https://docs.oracle.com/javase/tutorial/java/generics/types.html">Generic Type</a> provided by the implementing class) and a <code>disconnect()</code> method.</p>

<p>For demonstration purposes, we&#39;ve chosen to implement a simple hash-token scheme for creating an authentication String to be used within a Snap to connect to some service.</p>
<h2 id='associating-accounts-with-snaps'>Associating Accounts with Snaps</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">snaps</span><span class="o">;</span>
<span class="o">...</span>
<span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Account Example"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Authenticates with an Account"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="nd">@Accounts</span><span class="o">(</span><span class="n">provides</span> <span class="o">=</span> <span class="o">{</span><span class="n">ExampleAccount</span><span class="o">.</span><span class="na">class</span><span class="o">},</span> <span class="n">optional</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SnapWithAccount</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SnapWithAccount</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER_ID_COPY</span> <span class="o">=</span> <span class="s">"userIdCopy"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userIdCopy</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ExampleAccount</span> <span class="n">snapAccount</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="n">PropertyBuilder</span> <span class="n">propertyBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">USER_ID_COPY</span><span class="o">,</span> <span class="s">"User ID Copy"</span><span class="o">,</span> 
                <span class="s">"Demonstrates account.userId expression variable"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">expression</span><span class="o">(</span><span class="n">SnapProperty</span><span class="o">.</span><span class="na">DecoratorType</span><span class="o">.</span><span class="na">ACCEPTS_SCHEMA</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
        <span class="n">userIdCopy</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">USER_ID_COPY</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">snapAccount</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"token"</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"userId"</span><span class="o">,</span> <span class="n">userIdCopy</span><span class="o">);</span>

        <span class="c1">// do something with the token</span>

        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocumentFor</span><span class="o">(</span><span class="n">document</span><span class="o">,</span> <span class="n">data</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>@Accounts</code> metadata annotation is used to declare what Accounts are supported by the Snap. The <code>provides</code> argument value lists the supported Account classes, and the <code>optional</code> argument instructs the Designer whether to prompt for an Account as soon the Snap is dragged onto the canvas.</p>

<p>The <code>ExampleAccount</code> instance bound to the &quot;Example Account&quot; Account created earlier can then be injected into the Snap and used, for example, in the <code>execute()</code>/<code>process()</code> method to <code>connect()</code> to a target service provider or to generate an authentication token etc.</p>

<aside class="success">
Remember to declare the new Snap in the Snap POM's <code>&lt;snap.classes&gt;</code> element e.g.
<br />
<br />
<code>&lt;snap.classes&gt;
<br />&nbsp;&nbsp;com.snaplogic.snaps.DocConsumer,
<br />&nbsp;&nbsp;com.snaplogic.snaps.DocGenerator,
<br />&nbsp;&nbsp;com.snaplogic.snaps.PropertyTypes,
<br />&nbsp;&nbsp;com.snaplogic.snaps.SchemaExample,
<br />&nbsp;&nbsp;com.snaplogic.snaps.SingleDocGenerator,
<br />&nbsp;&nbsp;com.snaplogic.snaps.Suggest,
<br />&nbsp;&nbsp;com.snaplogic.snaps.TwoInputs,
<br />&nbsp;&nbsp;com.snaplogic.snaps.TwoInputsTwoOutputs,
<br />&nbsp;&nbsp;<strong>com.snaplogic.snaps.SnapWithAccount</strong>
<br />&lt;/snap.classes&gt;
</code>
</aside>
<h2 id='exposing-account-properties'>Exposing Account Properties</h2><pre class="highlight java tab-java"><code><span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Example Snap Account"</span><span class="o">)</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@AccountCategory</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">AccountType</span><span class="o">.</span><span class="na">CUSTOM</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleAccount</span> <span class="kd">implements</span> <span class="n">Account</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;,</span> <span class="n">AccountVariableProvider</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getAccountVariableValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ExpressionVariableAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="k">new</span> <span class="n">ImmutableSet</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;()</span>
                        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">,</span> <span class="n">getUserId</span><span class="o">()))</span>
                        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">(</span><span class="n">PASSPHRASE</span><span class="o">,</span> <span class="n">getPassphrase</span><span class="o">()))</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>SnapWithAccount</code> sample also demonstrates another Snap/Account integration by exposing property values of the associated <code>Account</code> instance in the Settings of the Snap.</p>

<p>To do this, have the Account implement the <code>AccountVariableProvider</code> interface and its <code>getAccountVariableValue()</code> method, and store the  e.g.</p>

<p>The <code>account.userId</code> and <code>account.passphrase</code> expression variables can then be used within the Snap&#39;s expression-enabled properties:</p>

<p><img src="images/yF6t.png" alt="Account Expression Variable" /></p>

<aside class="notice">
Do not prefix the <code>account</code> expression variable with <code>$</code> as it is not in the document. It also has the limitation that it is not listed within the expression UI's "Functions and properites" dropdown/tree.
</aside>
<h3 id='account-types'>Account Types</h3>
<p>In the <code>ExampleAccount</code> sample provided, the Account has been marked with the <code>@AccountCategory</code> annotation, whose <code>type</code> argument value is <code>AccountType.CUSTOM</code>.</p>

<p>The list of provided Account Category Types are:</p>

<ul>
<li><code>NONE</code></li>
<li><code>CUSTOM</code></li>
<li><code>BASIC_AUTH</code></li>
<li><code>SSH</code></li>
<li><code>SSL</code></li>
<li><code>DATABASE</code></li>
<li><code>OAUTH2</code></li>
<li><code>OAUTH1</code></li>
<li><code>AWS_S3</code></li>
<li><code>SAP</code></li>
</ul>
<h2 id='validating-accounts'>Validating Accounts</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>

<span class="cm">/**
 * A marker interface for the accounts that can be validated
 *
 * @param &lt;T&gt; as the return type for {@link #connect}
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ValidatableAccount</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Account</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre>
<p>Implementing the marker interface <code>ValidatableAccount</code>, which extends <code>Account</code>, will add a <strong>&quot;Validate&quot;</strong> button to the Account Settings&#39;s UI. </p>

<div class="inline-code">
public class ExampleAccount implements <strong>ValidatableAccount&lt;String&gt;</strong>, AccountVariableProvider {
...
}
</div>

<p>When clicked, this will trigger a call to the Account&#39;s <code>connect()</code> method. If the <code>connect()</code> method returns successfully (an exception is not thrown), the Account will be deemed validated:</p>

<p><img src="images/KsZR.png" alt="Successful Account Validation" /></p>
<h2 id='validation-specific-behavior'>Validation-specific Behavior</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>
<span class="o">...</span>
<span class="cm">/**
 * A marker interface for the accounts that can be validated.
 * This interface can be implemented when connect() method is not sufficient to validate the
 * account.
 *
 * @param &lt;T&gt; as a return type for {@link #validate}
 * @param &lt;R&gt; as an argument for {@link #validate}
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExtendedValidatableAccount</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">R</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">ValidatableAccount</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * Validates the account. Please note that connect() should not be called by this validator.
     * If needed, one needs to call connect() separately.
     *
     * @param arg - argument needed to validate the account
     *
     * @return an optional value that might be needed to access the session
     * @throws ExecutionException
     */</span>
    <span class="n">T</span> <span class="nf">validate</span><span class="o">(</span><span class="n">R</span> <span class="n">arg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<p>Implementing <code>ExtendedValidatableAccount</code>, which extends <code>ValidatableAccount</code>, will also add a <strong>&quot;Validate&quot;</strong> button to the Account Settings&#39;s UI. </p>

<p>However, it will instead trigger a call to <code>Account.validate()</code>, rather than <code>connect()</code>, when the <strong>&quot;Validate&quot;</strong> button in the Account Settings&#39; UI is clicked. A separate Generic Type is required for the return type of the <code>validate()</code> method.</p>

<div class="inline-code">
public class ExampleAccount implements ExtendedValidatableAccount&lt;String, String&gt;, AccountVariableProvider {
    ...
    @Override
    public String validate(String arg) {
        // some validation-specific actions
    }
}
</div>

<p>This is useful when an Account can be validated in a different manner versus connecting the Account during Snap execution.</p>
<h2 id='supporting-multiple-accounts'>Supporting Multiple Accounts</h2><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">snaplogic</span><span class="o">.</span><span class="na">snaps</span><span class="o">;</span>
<span class="o">...</span>
<span class="kn">import</span> <span class="nn">com.snaplogic.account.api.capabilities.MultiAccountBinding</span><span class="o">;</span>
<span class="o">...</span>
<span class="nd">@Accounts</span><span class="o">(</span><span class="n">provides</span> <span class="o">=</span> <span class="o">{</span><span class="n">ExampleAccount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">AnotherAccount</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SnapWithAccount</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="kd">implements</span> <span class="n">MultiAccountBinding</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

    <span class="cm">/*
    Step #1: when the Snap is initialized, the Account type (with String generic type) is 
    bound to the Account instance registered with the Snap.
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Module</span> <span class="nf">getManagedAccountModule</span><span class="o">(</span><span class="kd">final</span> <span class="n">Account</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">bind</span><span class="o">(</span><span class="n">Key</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeLiteral</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;()</span> <span class="o">{})).</span><span class="na">toInstance</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="cm">/*
    Step #2: Guice will inject the Account instance that was bound below.
     */</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">Account</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">snapAccount</span><span class="o">;</span>

    <span class="o">...</span>

    <span class="cm">/*
    Step 3: by the time it gets here, snapAccount will have been bound to the Account 
    instance in the Account Registry for this Snap.
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">snapAccount</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>@Accounts</code> annotation allows multiple Account classes to be registered to the <code>provides</code> argument.</p>

<p>The <code>MultiAccountBinding</code> interface possesses a <code>getManagedAccountModule()</code> method that returns a <a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Module.html">Guice <code>Module</code></a>.</p>

<p>Implementations of this method can then return an <a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/AbstractModule.html"><code>AbstractModule</code></a> instance which binds the <code>Account&lt;String&gt;</code> type literal <a href="https://github.com/google/guice/wiki/InstanceBindings">to the instance</a> of the <code>Account</code> registered with the Snap.</p>

<p>Then, when it is time for the <code>Account&lt;String&gt;</code> instance to be injected, Guice will use the instance bound to above and assign it to the <code>snapAccount</code> instance variable.</p>
<h1 id='jtest-snap-unit-testing-framework'>jtest: Snap Unit Testing Framework</h1>
<p>We briefly touched on unit testing Snaps with <strong>jtest</strong> earlier in the <a href="#unit-testing-snaps-with-snaptestrunner">Unit Testing Snaps with SnapTestRunner</a> section. </p>

<p>In the provided <code>SingleDocGeneratorTest</code> sample, we saw how to use the <code>SnapTestRunner</code> JUnit runner, and how to use the <code>@TestFixture</code> annotation to target a Snap, simulate its execution, and verify its output.</p>
<h2 id='declarative-testing-with-testfixture'>Declarative Testing with TestFixture</h2>
<p><code>@TestFixture</code> is the annotation for declaratively setting up a Snap unit test.</p>

<p>It provides a number of methods to make testing a Snap as easy as possible. Indeed, it is possible to test a Snap entirely without writing an test-specific implementation.</p>

<table><thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>snap</code></td>
<td>Returns the Snap class to be tested.</td>
</tr>
<tr>
<td><code>input</code></td>
<td>Returns the path to the file that represents the input data.</td>
</tr>
<tr>
<td><code>inputs</code></td>
<td>Returns the names of the input views for this unit test.<br />The input name has to match the one<br />defined in the input properties file.</td>
</tr>
<tr>
<td><code>outputs</code></td>
<td>Returns the names of the output views for this unit test.</td>
</tr>
<tr>
<td><code>errors</code></td>
<td>Returns the names of the error views for this unit test.</td>
</tr>
<tr>
<td><code>exception</code></td>
<td>Returns the exception class that is expected to be thrown.</td>
</tr>
<tr>
<td><code>expectedOutputPath</code></td>
<td>The path to the directory where expected output<br />files can be found.<br />The files are named based on the test method name followed by<br />&quot;-out.json&quot; (e.g. testBasic-out.json).<br />Expected output will be written to a<br />temporary directory on failure,<br />so you can just copy the files from there<br />to the expected directory if an update is needed.</td>
</tr>
<tr>
<td><code>expectedErrorPath</code></td>
<td>The path to the directory where expected error output<br />files can be found.<br />The files are named based on the test method name followed by<br />&quot;-err.json&quot; (e.g. testBasic-err.json).<br />Expected output will be written to a<br />temporary directory on failure,<br />so you can just copy the files from there<br />to the expected directory if an update is needed.</td>
</tr>
<tr>
<td><code>account</code></td>
<td>Returns the Account class to be tested.</td>
</tr>
<tr>
<td><code>accountProperties</code></td>
<td>Returns the path to the Account properties<br />file to use for this unit test.</td>
</tr>
<tr>
<td><code>properties</code></td>
<td>Returns the path to the Snap properties<br />file to use for this unit test.</td>
</tr>
<tr>
<td><code>propertyOverrides</code></td>
<td>Overrides for Snap properties specified by<br />the properties file.<br />The value should be pairs of strings where the left-side<br />is the JSON-Path to write and the right-side is the<br />JSON-encoded value to store in the path.</td>
</tr>
<tr>
<td><code>injectorModule</code></td>
<td><a href="https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/Module.html">Guice Module</a> that can override bindings<br />in the default test module.</td>
</tr>
<tr>
<td><code>dataFiles</code></td>
<td>Returns an array of data file paths.<br />These files will be available in the <code>URLStreamHandlerFactory</code> factory.</td>
</tr>
<tr>
<td><code>dataFilesSupplier</code></td>
<td>If specified, an instance of this class will be created<br />and used to supply an array of data file paths<br />for the <code>URLStreamHandlerFactory</code> factory.<br />This is an alternative to specifying <code>dataFiles</code> when<br />the same set of data files is needed by multiple tests.<br />If both <code>dataFiles</code> and <code>dataFilesSupplier</code> are specified,<br /><code>dataFiles</code> will be used.</td>
</tr>
<tr>
<td><code>suggestProperty</code></td>
<td>The path to the snap property to do suggestions for.<br />The result of the suggestions is written to a<br />fake output view so that you can use the <code>expectedOutputPath</code><br />mechanism to validate the results.</td>
</tr>
</tbody></table>

<p>The following sections will use the unit tests included in the <a href="#snap-maven-archetype">Snap Maven Archetype</a>.</p>
<h2 id='recording-output-test-data'>Recording Output Test Data</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingleDocGeneratorTest</span> <span class="o">{</span>

    <span class="c1">// "snap" attribute targets the Snap being executed</span>
    <span class="c1">// "outputs" defines the name of the output view to write to</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SingleDocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">singleDocGenerator_WithOutputView_OutputsCorrectNumDocuments</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">OutputRecorder</span> <span class="n">outputRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getOutputViewByName</span><span class="o">(</span><span class="s">"output0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">outputRecorder</span><span class="o">.</span><span class="na">getRecordedData</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>This example uses a <code>TestResult</code> argument to instruct the <code>SnapTestRunner</code> to automatically execute the test but to manually verify the test result.</p>

<p>Specify an output view name in <code>outputs</code> and then call <code>getRecordedData()</code> on the <code>OutputRecorder</code> instance returned by the <code>testResult.getOutputViewByName()</code> call using that same output view name.</p>
<h2 id='examining-error-views'>Examining Error Views</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchemaExampleTest</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SchemaExample</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">input</span> <span class="o">=</span> <span class="s">"data/schema_invalid_input.data"</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">,</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="s">"error0"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testInValidDataAgainstSchema</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// Since the input document does not conform to the expected schema,</span>
        <span class="c1">// there should be no output.</span>
        <span class="n">OutputRecorder</span> <span class="n">outputRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getOutputViewByName</span><span class="o">(</span><span class="s">"output0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">outputRecorder</span><span class="o">.</span><span class="na">getDocumentCount</span><span class="o">());</span>

        <span class="c1">// Input document should be forwarded to the error view as it does not</span>
        <span class="c1">// match the expected schema.</span>
        <span class="n">OutputRecorder</span> <span class="n">errorRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getErrorViewByName</span><span class="o">(</span><span class="s">"error0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">errorRecorder</span><span class="o">.</span><span class="na">getDocumentCount</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Very similar to <a href="#recording-output-test-data">Recording Output Test Data</a>, except the <code>testResult.getErrorViewByName()</code> method is called instead to inspect the document send to the error view name defined by the <code>errors</code> fixture parameter.</p>
<h2 id='providing-input-test-data'>Providing Input Test Data</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchemaExampleTest</span> <span class="o">{</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SchemaExample</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">input</span> <span class="o">=</span> <span class="s">"data/schema_valid_input.data"</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testValidDataAgainstSchema</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// Input document should appear on the output</span>
        <span class="n">OutputRecorder</span> <span class="n">outputRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getOutputViewByName</span><span class="o">(</span><span class="s">"output0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">outputRecorder</span><span class="o">.</span><span class="na">getDocumentCount</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p><code>input</code> specifies the path to the file that represents the data entering the input view, for example:</p>

<p><em>data/schema_valid_input.data</em>
<div class="inline-code">
{
    &quot;input0&quot; : [
        {
            &quot;colA&quot; : &quot;colA&quot;,
            &quot;colB&quot; : &quot;colB&quot;,
            &quot;colC&quot; : &quot;colC&quot;
        }
    ]
}
</div></p>

<p>The format of the input data file is:</p>

<div class="inline-code">
{
    "input_view_name" : data (can be a dict, an array or primitives),
    "input_view_name" : data (can be a dict, an array or primitives)
}
</div>

<p>Example:</p>

<div class="inline-code">
{
    "input0" : [1, 2, 3, 4, 5],
    "input1" : ["foo", "bar", "baz"]
}
</div>

<p>The format of a binary input data file is:</p>

<div class="inline-code">
{
    "input_view_name" : [data_file_path, ...],
    "input_view_name" : [data_file_path, ...]
}
</div>

<p>Example:</p>

<div class="inline-code">
{
    "input0" : ["data/files/json_input1.json", "data/files/json_input1.json"],
    "input1" : ["data/files/json_input2.json"]
}
</div>

<p>Optionally, headers can be specified for any array element as follows:</p>

<div class="inline-code">
{
    "input0" : [
        {
            "header" : {
                "content-type" : "application/json"
            },
            "content" : "data/files/json_input1.json"
        }, 
        "data/files/json_input1.json"
    ],
    "input1" : ["data/files/json_input2.json"]
}
</div>
<h2 id='specifying-snap-test-properties'>Specifying Snap Test Properties</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocGeneratorTest</span> <span class="o">{</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">DocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/doc_generator_properties.json"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDocGeneratorFunctionality</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">OutputRecorder</span> <span class="n">outputRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getOutputViewByName</span><span class="o">(</span><span class="s">"output0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">outputRecorder</span><span class="o">.</span><span class="na">getRecordedData</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre>
<p><code>properties</code> can be used to simulate user input into a Snap&#39;s settings, including expression-enabled properties.</p>

<p>The format of the property data file is:</p>

<div class="inline-code">
{
    "category" : { <em>a dict</em> },
    "another" : { <em>a dict</em> }
}
</div>

<p>Example:</p>

<div class="inline-code">
{
    "settings" : {
        "filename" : {
            "value": "$someProperty",
            "expression": true
        },
        "delim" : {
            "value" : ","
        },
        "composition" : {
            ...
        }
    }
}
</div>
<h2 id='overriding-specific-properties'>Overriding Specific Properties</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocGeneratorTest</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="c1">// "propertyOverrides" allows overriding specific values defined in the "properties" file</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">DocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/doc_generator/doc_generator_properties.json"</span><span class="o">,</span>
            <span class="n">propertyOverrides</span> <span class="o">=</span> <span class="o">{</span><span class="s">"$.settings.count.value"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">docGenerator_WithPropertyOverrides_OutputsCorrectNumDocuments</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">OutputRecorder</span> <span class="n">outputRecorder</span> <span class="o">=</span> <span class="n">testResult</span><span class="o">.</span><span class="na">getOutputViewByName</span><span class="o">(</span><span class="s">"output0"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="n">outputRecorder</span><span class="o">.</span><span class="na">getRecordedData</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p><code>propertiesOverrides</code> can override the value of a Snap property specified in the <code>properties</code> file.</p>

<p>The value should be pairs of strings where the left-side is the JSON-Path to write and the right-side is the JSON-encoded value to store in the path.</p>

<p>Example:</p>

<div class="inline-code">
...
propertyOverrides = {
    "$.settings.delim.value", ";"
}
...
</div>
<h2 id='modifying-private-fields-with-testsetup'>Modifying Private Fields with TestSetup</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocConsumerTest</span> <span class="o">{</span>

    <span class="c1">// a TestSetup argument allows interacting with the test before triggering it</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">DocConsumer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">docConsumer_WithManualTestSetup_UpdatesCounterCorrectly</span><span class="o">(</span><span class="n">TestSetup</span> <span class="n">testSetup</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">testSetup</span><span class="o">.</span><span class="na">addInputView</span><span class="o">(</span><span class="s">"input0"</span><span class="o">,</span> <span class="n">Arrays</span><span class="o">.&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="n">asList</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="s">"2"</span><span class="o">));</span>

        <span class="c1">// This demonstrates how get a reference to a private field within a Snap using TestSetup</span>
        <span class="n">AtomicInteger</span> <span class="n">count</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">testSetup</span><span class="o">.</span><span class="na">inject</span><span class="o">().</span><span class="na">fieldName</span><span class="o">(</span><span class="s">"count"</span><span class="o">).</span><span class="na">dependency</span><span class="o">(</span><span class="n">count</span><span class="o">).</span><span class="na">add</span><span class="o">();</span>

        <span class="n">TestResult</span> <span class="n">testResult</span> <span class="o">=</span> <span class="n">testSetup</span><span class="o">.</span><span class="na">test</span><span class="o">();</span> <span class="c1">// test the Snap by running through its lifecycle</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">count</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <a href="#reading-documents-from-an-input-view"><code>DocConsumer</code> sample Snap</a> contains a private <code>AtomicInteger</code> &quot;count&quot; field.</p>

<p>If we wish to change this field directly, we can use <code>inject()</code> from <code>TestSetup</code>.</p>

<p>A <code>TestSetup</code> argument allows modifying what is to be tested in advance of triggering the test&#39;s execution with the <code>test()</code> method.</p>
<h2 id='declarative-testing'>Declarative Testing</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocGeneratorTest</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="cm">/**
     * Tests that the {@link DocGenerator} Snap's output generated for the given value of "count"
     * property matches with what is provided in a separate file referred to by "expectedOutputPath"
     * attribute of the TestFixture annotation.
     */</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">DocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">,</span>
            <span class="n">expectedOutputPath</span> <span class="o">=</span> <span class="s">"data/doc_generator"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/doc_generator/doc_generator_properties.json"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">docGenerator_WithExpectedOutputPath_OutputsDocumentsCorrectly</span><span class="o">()</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// "expectedErrorPath" specifies the folder that contains the</span>
    <span class="c1">// "docGenerator_WithExpectedErrorPath_OutputsErrorDocumentCorrectly-err.json" file</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">DocGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="s">"error0"</span><span class="o">,</span>
            <span class="n">expectedErrorPath</span> <span class="o">=</span> <span class="s">"data/doc_generator"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/doc_generator/doc_generator_properties.json"</span><span class="o">,</span>
            <span class="n">propertyOverrides</span> <span class="o">=</span> <span class="o">{</span><span class="s">"$.settings.count.value"</span><span class="o">,</span> <span class="s">"-2"</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">docGenerator_WithExpectedErrorPath_OutputsErrorDocumentCorrectly</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharacterCounterTest</span> <span class="o">{</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">CharacterCounter</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">input</span> <span class="o">=</span> <span class="s">"data/character_counter/character_counter_input_pointer.json"</span><span class="o">,</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="s">"output0"</span><span class="o">,</span>
            <span class="n">expectedOutputPath</span> <span class="o">=</span> <span class="s">"data/character_counter"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">characterCounter_WithSnapLogicAsInput_CountsOccurrences</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
<p>While both <code>TestSetup</code> and <code>TestResult</code> allow fine-grained control over the test execution, we can gain a lot of benefits in a declarative model of testing, where test inputs, outputs, and configuration are all defined in files external to the test.</p>

<p>We saw earlier in <a href="#providing-input-test-data">Providing Input Test Data</a> how to use the <code>input</code> annotation parameter to specify the incoming documents, but we can also externalize the expected output and error documents.</p>

<p>The <code>expectedOutputPath</code> and <code>expectedErrorPath</code> attributes specify folders that contains files that following a naming convertion. The file must match the test name plus a suffix like <code>&quot;-out.json&quot;</code> or <code>&quot;-err.json&quot;</code>. However, if those files do not exist or differ, the test runner will write the actual output to a temporary file, making it easy to copy them over (if valid):</p>

<p><img src="images/xamy.png" alt="Temp result file" /></p>

<p>If the output is of <a href="#writing-binary-data-to-an-output-view">binary type</a>, then a folder matching the test name and containing the expected header and data files must be created:</p>

<p><img src="images/Tw5f.png" alt="Expected Test File Name Format" /></p>

<p><code>DocGeneratorTest</code> contains two tests that demonstrate externalizing expected output and error content, and <code>CharacterCounterTest</code> shows similar but for a binary-output Snap.</p>
<h2 id='testing-suggestions'>Testing Suggestions</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SuggestTest</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FOO</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">;</span>

    <span class="c1">// asserting using TestSetup.suggest()</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">Suggest</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">suggest_WithTestSetupAndSuggest_ReturnsCorrectValue</span><span class="o">(</span><span class="n">TestSetup</span> <span class="n">testSetup</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// Set the value for the property "name"</span>
        <span class="n">testSetup</span><span class="o">.</span><span class="na">setPropertyValue</span><span class="o">(</span><span class="n">Suggest</span><span class="o">.</span><span class="na">PROP_NAME</span><span class="o">,</span> <span class="n">FOO</span><span class="o">);</span>
        <span class="c1">// Call suggest for the property "echo"</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="n">testSetup</span><span class="o">.</span><span class="na">suggest</span><span class="o">(</span><span class="n">Suggest</span><span class="o">.</span><span class="na">PROP_ECHO</span><span class="o">);</span>
        <span class="c1">// This should return the value that was set for the property "name"</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">FOO</span><span class="o">),</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Suggest</span><span class="o">.</span><span class="na">PROP_ECHO</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// "suggestProperty" and "expectedOutputPath" can be used together to declare the expected</span>
    <span class="c1">// output of a Suggest action on the specified property</span>
    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">Suggest</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">suggestProperty</span> <span class="o">=</span> <span class="n">Suggest</span><span class="o">.</span><span class="na">PROP_ECHO</span><span class="o">,</span>
            <span class="n">expectedOutputPath</span> <span class="o">=</span> <span class="s">"data/suggest"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/suggest/suggest_properties.json"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">suggest_WithSuggestProperty_WritesResultsToSpecialOutputView</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Testing <a href="#suggesting-property-values">Suggested property values</a> can be done two ways: with the <code>TestSetup.suggest()</code> method or with the <code>suggestProperty</code> annotation parameter. </p>

<p>The former executes the <code>Suggestions</code> instance assigned to the specified property. The latter creates a fake output view for the suggest results and writes it to there; as outlined in the <a href="#declarative-testing">Declarative Testing</a> section, this also benefits from actual executions being written to temp files to be copied to your test resources folder.</p>

<div class="inline-code">
{
  "out": [{
    "echo": ["foo"]
  }]
}
</div>
<h2 id='injecting-test-dependencies'>Injecting Test Dependencies</h2><pre class="highlight java tab-java"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SnapTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@TestFixture</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">CurrencyConverter</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">expectedOutputPath</span> <span class="o">=</span> <span class="s">"data/currency_converter/expected"</span><span class="o">,</span>
        <span class="n">expectedErrorPath</span> <span class="o">=</span> <span class="s">"data/currency_converter/expected"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CurrencyConverterTest</span> <span class="o">{</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">input</span> <span class="o">=</span> <span class="s">"data/currency_converter/input_documents.json"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">currencyConverstion_WithFieldMockedDirectly_ConvertsCorrectly</span><span class="o">(</span><span class="n">TestSetup</span> <span class="n">testSetup</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// This demonstrates how to inject mocks into Snap fields.</span>
        <span class="n">ForEx</span> <span class="n">forExMock</span> <span class="o">=</span> <span class="n">createMock</span><span class="o">(</span><span class="n">ForEx</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">expect</span><span class="o">(</span><span class="n">forExMock</span><span class="o">.</span><span class="na">getExchangeRates</span><span class="o">(</span><span class="n">anyString</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andReturn</span><span class="o">(</span><span class="k">new</span> <span class="n">FakeForeignExchange</span><span class="o">().</span><span class="na">getExchangeRates</span><span class="o">(</span><span class="s">"USD"</span><span class="o">)).</span><span class="na">anyTimes</span><span class="o">();</span>
        <span class="n">replay</span><span class="o">(</span><span class="n">forExMock</span><span class="o">);</span>

        <span class="n">testSetup</span><span class="o">.</span><span class="na">inject</span><span class="o">().</span><span class="na">fieldName</span><span class="o">(</span><span class="s">"foreignExchange"</span><span class="o">).</span><span class="na">dependency</span><span class="o">(</span><span class="n">forExMock</span><span class="o">).</span><span class="na">add</span><span class="o">();</span>

        <span class="n">TestResult</span> <span class="n">testResult</span> <span class="o">=</span> <span class="n">testSetup</span><span class="o">.</span><span class="na">test</span><span class="o">();</span>

        <span class="n">verify</span><span class="o">(</span><span class="n">forExMock</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">input</span> <span class="o">=</span> <span class="s">"data/currency_converter/input_documents.json"</span><span class="o">,</span>
            <span class="n">injectorModule</span> <span class="o">=</span> <span class="n">FakeForeignExchangeInjector</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">currencyConversion_WithCustomInjector_ConvertsCorrectly</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">input</span> <span class="o">=</span> <span class="s">"data/currency_converter/input_documents.json"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/currency_converter/exchange_rates_from_file_properties.json"</span><span class="o">,</span>
            <span class="n">dataFiles</span> <span class="o">=</span> <span class="o">{</span><span class="s">"data/currency_converter/exchange_rates_file.json"</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">currencyConversion_WithExchangeRatesFromDataFiles_ConvertsCorrectly</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@TestFixture</span><span class="o">(</span><span class="n">input</span> <span class="o">=</span> <span class="s">"data/currency_converter/input_documents.json"</span><span class="o">,</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="s">"data/currency_converter/exchange_rates_from_file_properties.json"</span><span class="o">,</span>
            <span class="n">dataFilesSupplier</span> <span class="o">=</span> <span class="n">ExchangeRatesSupplier</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">currencyConversion_WithExchangeRatesDataSupplier_ConvertsCorrectly</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FakeForeignExchangeInjector</span> <span class="kd">extends</span> <span class="n">AbstractModule</span> <span class="o">{</span>
        <span class="n">FakeForeignExchange</span> <span class="n">fakeForeignExchange</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FakeForeignExchange</span><span class="o">();</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">bind</span><span class="o">(</span><span class="n">ForEx</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span><span class="n">fakeForeignExchange</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FakeForeignExchange</span> <span class="kd">implements</span> <span class="n">ForEx</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">rate</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">FakeForeignExchange</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getExchangeRates</span><span class="o">(</span><span class="n">String</span> <span class="n">currencyCode</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">rate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"base"</span><span class="o">,</span> <span class="s">"USD"</span><span class="o">);</span>
            <span class="n">rate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"date"</span><span class="o">,</span> <span class="s">"2016-09-12"</span><span class="o">);</span>

            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">forExRates</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">forExRates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"AUD"</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">1.3299</span><span class="o">));</span>
            <span class="n">forExRates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"GBP"</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">0.75249</span><span class="o">));</span>
            <span class="n">forExRates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"EUR"</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">0.89079</span><span class="o">));</span>
            <span class="n">rate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"rates"</span><span class="o">,</span> <span class="n">forExRates</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">rate</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ExchangeRatesSupplier</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">[]&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
                    <span class="s">"data/currency_converter/exchange_rates_file.json"</span>
            <span class="o">};</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>There are two ways of injecting test dependencies - with the <code>inject()</code> approach described previously or with <code>injectorModule</code>. Both are shown here in <code>CurrencyConverterTest</code>.</p>

<p><code>injectorModule</code> allows providing a custom <code>AbstractModule</code> class to override Guice bindings and influence fields annotated with <code>@Inject</code>.</p>

<p>In the test, a <code>FakeForeignExchange</code> instance is bound to the <code>ForEx</code> instance instead of the <code>ForExImpl</code> implementation in the <code>CurrencyConverter</code> class.</p>
<h1 id='propertybuilder-reference'>PropertyBuilder Reference</h1><pre class="highlight java tab-java"><code><span class="nd">@General</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Property Types"</span><span class="o">,</span> <span class="n">purpose</span> <span class="o">=</span> <span class="s">"Demonstrates use of different property types"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Your Company Name"</span><span class="o">,</span> <span class="n">docLink</span> <span class="o">=</span> <span class="s">"http://yourdocslinkhere.com"</span><span class="o">)</span>
<span class="nd">@Category</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="n">SnapCategory</span><span class="o">.</span><span class="na">READ</span><span class="o">)</span>
<span class="nd">@Version</span><span class="o">(</span><span class="n">snap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="nd">@Inputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">accepts</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="nd">@Outputs</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">offers</span> <span class="o">=</span> <span class="o">{</span><span class="n">ViewType</span><span class="o">.</span><span class="na">DOCUMENT</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyTypes</span> <span class="kd">extends</span> <span class="n">SimpleSnap</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PASSWORD_PROP</span> <span class="o">=</span> <span class="s">"password_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FILE_BROWSER_PROP</span> <span class="o">=</span> <span class="s">"file_browser_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CHILD_FILE_BROWSER_PROP</span> <span class="o">=</span> <span class="s">"child_file_browser_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CHILD_PROP</span> <span class="o">=</span> <span class="s">"child_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PARENT_PROP</span> <span class="o">=</span> <span class="s">"parent_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COLUMN_FILE_BROWSER_PROP</span> <span class="o">=</span> <span class="s">"column_file_browser_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">COLUMN_PROP</span> <span class="o">=</span> <span class="s">"column_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TABLE_PROP</span> <span class="o">=</span> <span class="s">"table_prop"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PASSWORD_PROP_VALUE</span> <span class="o">=</span> <span class="s">"abc"</span><span class="o">;</span>

    <span class="c1">// Document utility is the only way to create a document</span>
    <span class="c1">// or manipulate the document header</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">DocumentUtility</span> <span class="n">documentUtility</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">fileBrowser</span><span class="o">;</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">composite</span><span class="o">;</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">table</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defineProperties</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyBuilder</span> <span class="n">propBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Password (obfuscate)</span>
        <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">PASSWORD_PROP</span><span class="o">,</span> <span class="n">PASSWORD_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">defaultValue</span><span class="o">(</span><span class="n">PASSWORD_PROP_VALUE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">obfuscate</span><span class="o">()</span> <span class="c1">// hides input and sets sensitivity to High</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>

        <span class="c1">// File Browsing</span>
        <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">FILE_BROWSER_PROP</span><span class="o">,</span> <span class="n">FILE_BROWSER_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">defaultValue</span><span class="o">(</span><span class="n">PASSWORD_PROP_VALUE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">fileBrowsing</span><span class="o">()</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>

        <span class="c1">// Composite Property</span>
        <span class="n">SnapProperty</span> <span class="n">fileBrowsingChild</span> <span class="o">=</span> <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">CHILD_FILE_BROWSER_PROP</span><span class="o">,</span>
                <span class="n">CHILD_FILE_BROWSER_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">fileBrowsing</span><span class="o">()</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="n">SnapProperty</span> <span class="n">child</span> <span class="o">=</span> <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">CHILD_PROP</span><span class="o">,</span> <span class="n">CHILD_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">PARENT_PROP</span><span class="o">,</span> <span class="n">PARENT_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">COMPOSITE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withEntry</span><span class="o">(</span><span class="n">fileBrowsingChild</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withEntry</span><span class="o">(</span><span class="n">child</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>

        <span class="c1">// Table Property</span>
        <span class="n">SnapProperty</span> <span class="n">fileBrowsingColumn</span> <span class="o">=</span> <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">COLUMN_FILE_BROWSER_PROP</span><span class="o">,</span>
                <span class="n">COLUMN_FILE_BROWSER_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">fileBrowsing</span><span class="o">()</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="n">SnapProperty</span> <span class="n">column</span> <span class="o">=</span> <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">COLUMN_PROP</span><span class="o">,</span> <span class="n">COLUMN_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">required</span><span class="o">()</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="n">propBuilder</span><span class="o">.</span><span class="na">describe</span><span class="o">(</span><span class="n">TABLE_PROP</span><span class="o">,</span> <span class="n">TABLE_PROP</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">SnapType</span><span class="o">.</span><span class="na">TABLE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withEntry</span><span class="o">(</span><span class="n">fileBrowsingColumn</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withEntry</span><span class="o">(</span><span class="n">column</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationException</span> <span class="o">{</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">PASSWORD_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">fileBrowser</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">FILE_BROWSER_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

        <span class="c1">// also consider storing a reference to the PropertyValues in an instance variable to be</span>
        <span class="c1">// used when when evaluating expressions against each incoming document in process()</span>
        <span class="n">composite</span> <span class="o">=</span> <span class="n">buildComposite</span><span class="o">(</span><span class="n">propertyValues</span><span class="o">);</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">buildTable</span><span class="o">(</span><span class="n">propertyValues</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/*
    Demonstrates using getAsExpression and getExpressionPropertyFor to retrieve parent and child
    components of a composite property set
     */</span>
    <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">buildComposite</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// a Map to hold the evaluated property values</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">composite</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// get the parent composite as an expression</span>
        <span class="c1">// the parent will resolve to a map of the child key-value pairs for each child</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">PARENT_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

        <span class="c1">// the getExpressionPropertyFor() method allows accessing the child expression variables</span>
        <span class="n">String</span> <span class="n">fileBrowsingChild</span> <span class="o">=</span>
                <span class="n">propertyValues</span><span class="o">.</span><span class="na">getExpressionPropertyFor</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">CHILD_FILE_BROWSER_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">child</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getExpressionPropertyFor</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">CHILD_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

        <span class="n">composite</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">CHILD_FILE_BROWSER_PROP</span><span class="o">,</span> <span class="n">fileBrowsingChild</span><span class="o">);</span>
        <span class="n">composite</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">CHILD_PROP</span><span class="o">,</span> <span class="n">child</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">composite</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/*
    Table properties are evaluated similarly to Composites, except they return Lists of Maps. The
    list can be iterated through (representing each "row" of the table) with each key-value pair
    representing a table property to be evaluated.
     */</span>
    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">buildTable</span><span class="o">(</span><span class="kd">final</span> <span class="n">PropertyValues</span> <span class="n">propertyValues</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// a List of Maps to represent the evaluated property values in a table</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// get the table property as an expression</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">tableProp</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getAsExpression</span><span class="o">(</span><span class="n">TABLE_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

        <span class="c1">// for each row of the table, get the child properties as an expression</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">aRow</span> <span class="o">:</span> <span class="n">tableProp</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">row</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>

            <span class="n">String</span> <span class="n">childFileBrowser</span> <span class="o">=</span>
                    <span class="n">propertyValues</span><span class="o">.</span><span class="na">getExpressionPropertyFor</span><span class="o">(</span><span class="n">aRow</span><span class="o">,</span> <span class="n">COLUMN_FILE_BROWSER_PROP</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">column</span> <span class="o">=</span> <span class="n">propertyValues</span><span class="o">.</span><span class="na">getExpressionPropertyFor</span><span class="o">(</span><span class="n">aRow</span><span class="o">,</span> <span class="n">COLUMN_PROP</span><span class="o">).</span><span class="na">eval</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

            <span class="n">row</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">COLUMN_FILE_BROWSER_PROP</span><span class="o">,</span> <span class="n">childFileBrowser</span><span class="o">);</span>
            <span class="n">row</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">COLUMN_PROP</span><span class="o">,</span> <span class="n">column</span><span class="o">);</span>

            <span class="n">table</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">row</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">table</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">String</span> <span class="n">inputViewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PASSWORD_PROP</span><span class="o">,</span> <span class="n">getPassword</span><span class="o">());</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">FILE_BROWSER_PROP</span><span class="o">,</span> <span class="n">getFileBrowser</span><span class="o">());</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"composite"</span><span class="o">,</span> <span class="n">getComposite</span><span class="o">());</span>
        <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"table"</span><span class="o">,</span> <span class="n">getTable</span><span class="o">());</span>

        <span class="n">outputViews</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">documentUtility</span><span class="o">.</span><span class="na">newDocument</span><span class="o">(</span><span class="n">data</span><span class="o">),</span> <span class="n">document</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileBrowser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileBrowser</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getComposite</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">composite</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getTable</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">table</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The <code>PropertyTypes</code> sample Snap in the <a href="#snap-maven-archetype">Snap Maven Archetype</a> demonstrates a number of the various UI components available to a Snap&#39;s Settings UI.</p>

<p><img src="images/LxWM.png" alt="Property Values" /></p>

<p>The <code>PropertyTypesTest</code> test class references a properties file that outlines the JSON structure of complex Snap settings like the above:</p>

<div class="inline-code">
{
  "settings": {
    "password_prop": {
      "value": "snaplogic"
    },
    "file_browser_prop": {
      "expression": false,
      "value": "file1.json"
    },
    "parent_prop": {
      "value": {
        "child_file_browser_prop": {
          "expression": false,
          "value": "file2.json"
        },
        "child_prop": {
          "value": "child"
        }
      }
    },
    "table_prop": {
      "value": [
        {
          "column_file_browser_prop": {
            "expression": false,
            "value": "file3.json"
          },
          "column_prop": {
            "value": "col1"
          }
        },
        {
          "column_file_browser_prop": {
            "expression": false,
            "value": "file4.json"
          },
          "column_prop": {
            "value": "col2"
          }
        }
      ]
    }
  }
}
</div>
<h3 id='snaptype-reference'>SnapType Reference</h3>
<div class="inline-code">
NUMBER("number", BigDecimal.class),
INTEGER("integer", BigInteger.class),
STRING("string", String.class),
DATETIME("date-time", DateTime.class),
LOCALDATETIME("local-date-time", LocalDateTime.class),
BOOLEAN("boolean", Boolean.class),
DATE("date", LocalDate.class),
TIME("time", LocalTime.class),
BINARY("binary", Byte.class),
TABLE("array", List.class),
ANY("any", Object.class),
COMPOSITE("object", Map.class),
BYTES("bytes", String.class);
</div>
<h1 id='updating-custom-snap-packs'>Updating Custom Snap Packs</h1><h2 id='overview-of-dependency-improvements'>Overview of Dependency Improvements</h2>
<p>The SnapLogic development team has performed a maintenance review of third-party library
dependencies in our platform and Snap Packs. This accomplished several objectives, including the
following:</p>

<ul>
<li>Upgrade to more recent versions of some important libraries, such as the AWS SDK, Apache 
HttpClient, Jackson, and Guava.</li>
<li>Use consistent versions of libraries across the platform and Snaps, where possible.</li>
<li>Eliminate dependencies that are no longer needed, resulting in a smaller memory footprint and 
better performance.</li>
<li>Provide a better foundation for parties building custom Snaps.</li>
<li>Bundle more dependencies into Snap Packs to reduce the need for the platform to provide those 
dependencies, allowing the version used by Snaps to vary from the version used by the platform when necessary.</li>
</ul>

<p>Previously, many dependencies that were used by both the platform and by Snaps were included only in 
the platform and referenced as provided scope dependencies by the Snaps rather than bundling them into the Snap Packs. 
However, any dependencies at the platform layer carry a rather substantial burden, since they are available globally in 
the classpath of the platform and all Snaps.</p>

<p>Our dependency audit found a number of dependencies that are no longer used by the platform per se. 
To eliminate the burden of these globally-available dependencies, they have been removed from the platform layer. 
However, this means that any Snap Packs that relied on any of those dependencies must be updated to bundle these 
dependencies using compile scope rather than provided scope when building the packs. SnapLogic has updated our 
standard Snap Packs accordingly. <strong>Custom Snap Packs must also be updated, rebuilt and redeployed to ensure proper 
functioning against the May 2020 (4.21) release of the platform.</strong></p>
<h2 id='updating-a-custom-snap-pack'>Updating a Custom Snap Pack</h2><h3 id='update-your-pom'>Update Your POM</h3>
<p>To ease the upgrade and ongoing maintenance of custom Snap Packs, SnapLogic now provides a Maven BOM 
(Bill Of Materials) file that declares a set of dependencies to use for building Snaps. 
This set of dependencies includes specific versions of both SnapLogic libraries and third-party libraries used by 
SnapLogic. This BOM can be imported into a Snap Pack’s POM file which reduces the amount of dependency information
that needs to be specified directly in the POM file.</p>

<p>Steps to update the POM file (pom.xml):</p>
<pre class="highlight xml tab-xml"><code>(step 1)
<span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        ...
        <span class="c">&lt;!-- import dependencies from the SnapLogic BOM --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.snaplogic.snaps<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>bom<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${snaplogic.snaps.version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        ...
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre><pre class="highlight xml tab-xml"><code>(step 6)
<span class="nt">&lt;properties&gt;</span>
    ...
    <span class="c">&lt;!-- SnapLogic SDK versions --&gt;</span>
    <span class="nt">&lt;snaplogic.platform.version&gt;</span>4.26.10240<span class="nt">&lt;/snaplogic.platform.version&gt;</span>
    <span class="nt">&lt;snaplogic.snaps.version&gt;</span>4.26.11320<span class="nt">&lt;/snaplogic.snaps.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre><pre class="highlight xml tab-xml"><code>(step 7)
<span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.snaplogic.tools<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>snappack-installer<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${snaplogic.platform.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
<ol>
<li><p>Import the BOM into your POM by adding the text shown in the code snippet to the <code>&lt;dependencyManagement&gt;</code> section.
If you don’t already have this section, add the <code>&lt;dependencyManagement&gt;</code> and <code>&lt;dependencies&gt;</code> elements.</p></li>
<li><p><a href="https://github.com/SnapLogicDev/sdk/packages/358891?version=4.26.11320">Download and view the BOM file using the link under Assets on this page.</a>.</p></li>
<li><p>If your POM already had a <code>&lt;dependencyManagement&gt;</code> section before importing the BOM, review each <code>&lt;dependency&gt;</code> in that 
section to see if it’s declared by the BOM. If so, remove that dependency from the <code>&lt;dependencyManagement&gt;</code> section.</p></li>
<li><p>Review the <code>&lt;dependencies&gt;</code> section (the one that’s a direct child of the root <code>&lt;project&gt;</code> element, not the one inside 
the <code>&lt;dependencyManagement&gt;</code> section). For each <code>&lt;dependency&gt;</code> in that section, see if it’s declared by the BOM. If so, 
keep the <code>&lt;dependency&gt;</code> and its <code>&lt;groupId&gt;</code> and <code>&lt;artifactId&gt;</code> but remove any <code>&lt;version&gt;</code>, <code>&lt;scope&gt;</code>, and <code>&lt;exclusions&gt;</code> so that those are declared only by the BOM.</p>

<p>You can also remove the <code>com.snaplogic:mrjob</code> dependency if it’s in your POM.</p></li>
<li><p>In the <code>&lt;properties&gt;</code> section of your POM, find the <code>sl_build</code> property and increment its value so that the new build of your Snap Pack has a unique version number. <a href="#deploying-a-new-version">(Read more about this property.)</a></p></li>
<li><p>Define <code>snaplogic.platform.version</code> and <code>snaplogic.snaps.version</code> in the <code>&lt;properties&gt;</code> section of your POM, as shown.</p></li>
<li><p>In the <code>&lt;pluginManagement&gt;</code> section of your POM, update the version of the <code>snaplogic-installer</code> plugins so that it references the
<code>snaplogic.platform.property</code> property added in the last step. (See code snippet.)</p>

<p>Also update these plugins to the version listed here:</p>

<ul>
<li><code>maven-assembly-plugin</code>: 3.2.0 </li>
<li><code>maven-compiler-plugin</code>: 3.5.1</li>
<li><code>properties-maven-plugin</code>: 1.0.0</li>
</ul></li>
<li><p>In the <code>&lt;plugins&gt;</code> section, update <code>maven-compiler-plugin</code>’s <code>source</code>/<code>target</code> values to 11.</p></li>
<li><p>In the <code>&lt;repositories&gt;</code> section, look for the Maven Central repository with this URL:</p>

<p><code>&lt;url&gt;http://repo1.maven.org/maven2&lt;/url&gt;</code></p>

<p>This repository now requires https, so add an “s” to the protocol specifier:</p>

<p><code>&lt;url&gt;https://repo1.maven.org/maven2&lt;/url&gt;</code></p></li>
</ol>
<h2 id='pom-changes-for-august-2020-release'>POM Changes for August 2020 release</h2>
<p>Starting with the August 2020 (4.22) release, the SnapLogic libraries required by Snaps are no longer deployed to
SnapLogic&#39;s Nexus server on maven.clouddev.snaplogic.com but are instead deployed to Github at https://github.com/SnapLogicDev/sdk/packages.
Furthermore, SnapLogic&#39;s maven artifacts now follow a more consistent, straightforward versioning strategy, and it is no longer necessary to use Maven profiles (develop, release, master) to reference different subdirectories within
the repository as it was when using pre-4.22 artifacts hosted on Nexus.</p>

<p>Accordingly, we recommend updating custom snap POMs to remove SnapLogic-specific <code>&lt;profile&gt;</code> definitions, move 
<code>&lt;repository&gt;</code> and <code>&lt;pluginRepository&gt;</code> elements from those profiles to the top level, and update the repository definitions
to reflect the new locations.</p>
<pre class="highlight xml tab-xml"><code>(REMOVE)

    <span class="nt">&lt;profiles&gt;</span>
        <span class="nt">&lt;profile&gt;</span>
            <span class="nt">&lt;id&gt;</span>develop<span class="nt">&lt;/id&gt;</span>
            ...
            <span class="nt">&lt;repositories&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>Snaplogic-Maven-Cloud-Repository<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/develop/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>Snaplogic-Maven-Cloud-Dev-Repository<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/releases/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>Snaplogic-ThirdPartyMaven-Repository<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
            <span class="nt">&lt;/repositories&gt;</span>
        <span class="nt">&lt;/profile&gt;</span>
        <span class="nt">&lt;profile&gt;</span>
            <span class="nt">&lt;id&gt;</span>release<span class="nt">&lt;/id&gt;</span>
            ...
            <span class="nt">&lt;repositories&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>sl_release<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/releases/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>Snaplogic-ThirdPartyMaven-Repository<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
            <span class="nt">&lt;/repositories&gt;</span>
            <span class="nt">&lt;pluginRepositories&gt;</span>
                <span class="nt">&lt;pluginRepository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>sl_release<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;name&gt;</span>Snaplogic Maven Repository<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/releases/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/pluginRepository&gt;</span>
                <span class="nt">&lt;pluginRepository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>sl_develop_snapshot<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;name&gt;</span>Snaplogic Maven Snapshot Repository<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/develop-snapshot/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/pluginRepository&gt;</span>
            <span class="nt">&lt;/pluginRepositories&gt;</span>
        <span class="nt">&lt;/profile&gt;</span>
        <span class="nt">&lt;profile&gt;</span>
            <span class="nt">&lt;id&gt;</span>master<span class="nt">&lt;/id&gt;</span>
            ...
            <span class="nt">&lt;repositories&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>sl_master<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/master/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
                <span class="nt">&lt;repository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>Snaplogic-ThirdPartyMaven-Repository<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/repository&gt;</span>
            <span class="nt">&lt;/repositories&gt;</span>
            <span class="nt">&lt;pluginRepositories&gt;</span>
                <span class="nt">&lt;pluginRepository&gt;</span>
                    <span class="nt">&lt;id&gt;</span>sl_master<span class="nt">&lt;/id&gt;</span>
                    <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/master/<span class="nt">&lt;/url&gt;</span>
                    ...
                <span class="nt">&lt;/pluginRepository&gt;</span>
            <span class="nt">&lt;/pluginRepositories&gt;</span>
        <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;/profiles&gt;</span>
</code></pre><h3 id='remove-profiles'>Remove profiles</h3>
<p><strong>Remove</strong> the <code>profiles</code> and <code>repositories</code> as summarized in the adjacent sample.</p>
<h3 id='define-repositories-and-pluginrepositories'>Define repositories and pluginRepositories</h3>
<p><strong>Create</strong> or <strong>update</strong> the <code>&lt;repositories&gt;</code> at the top-level of your POM to include each <code>&lt;repository&gt;</code> shown in the sample:</p>

<ul>
<li>central (Maven Central)</li>
<li>github_SnapLogicDev</li>
<li>Snaplogic-ThirdPartyMaven-Repository (still hosted on SnapLogic&#39;s Nexus repository)</li>
<li>any other repositories needed for other dependencies of your custom Snap project</li>
</ul>

<p><strong>Create</strong> or <strong>update</strong> the <code>&lt;pluginRepositories&gt;</code> at the top-level of your POM to include each <code>&lt;pluginRepository&gt;</code> shown in the sample:</p>

<ul>
<li>central (Maven Central)</li>
<li>github_SnapLogicDev</li>
<li>any other repositories needed for other dependencies of your custom Snap project</li>
</ul>
<pre class="highlight xml tab-xml"><code>(ADD)
    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>central<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Maven Central<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://repo1.maven.org/maven2<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>github_SnapLogicDev<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>SnapLogic Public SDK GitHub Packages<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://maven.pkg.github.com/SnapLogicDev/sdk<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>Snaplogic-ThirdPartyMaven-Repository<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Snaplogic ThirdParty Repository<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
        ...
    <span class="nt">&lt;/repositories&gt;</span>
    <span class="nt">&lt;pluginRepositories&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>central<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Maven Central<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://repo1.maven.org/maven2<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>github_SnapLogicDev<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>SnapLogic Public SDK GitHub Packages<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://maven.pkg.github.com/SnapLogicDev/sdk<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
    <span class="nt">&lt;/pluginRepositories&gt;</span>
</code></pre><h3 id='add-mvn-maven-config-and-settings-xml'>Add .mvn/maven.config and settings.xml</h3>
<p>Currently, the Github Package Registry cannot be accessed anonymously like other public repositories like Maven Central.
See <a href="https://github.community/t/download-from-github-package-registry-without-authentication/14407">this post</a> for more information.</p>

<p>However, to provide the required authentication during Maven builds, two files can be added to your snap project, shown
below. See <a href="https://github.community/t/how-to-allow-unauthorised-read-access-to-github-packages-maven-repository/115517">this post</a> 
for a more detailed discussion of this solution.</p>

<ul>
<li><p>.mvn/maven.config</p>

<p><code>-s settings.xml</code></p></li>
<li><p>settings.xml</p>

<p>(see sidebar)</p></li>
</ul>
<pre class="highlight xml tab-xml"><code><span class="c">&lt;!-- settings.xml --&gt;</span>
<span class="nt">&lt;settings</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/SETTINGS/1.0.0"</span>
  <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;servers&gt;</span>
        <span class="nt">&lt;server&gt;</span>
            <span class="nt">&lt;id&gt;</span>github_SnapLogicDev<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;username&gt;</span>thirdpartysnapdev<span class="nt">&lt;/username&gt;</span>
            <span class="c">&lt;!-- Public token with `read:packages` scope --&gt;</span>
            <span class="nt">&lt;password&gt;</span><span class="ni">&amp;#50;&amp;#53;&amp;#49;&amp;#55;&amp;#56;&amp;#54;&amp;#54;&amp;#48;&amp;#52;&amp;#102;&amp;#57;&amp;#54;&amp;#53;&amp;#102;&amp;#97;&amp;#100;&amp;#100;&amp;#54;&amp;#54;&amp;#57;&amp;#51;&amp;#52;&amp;#50;&amp;#53;&amp;#49;&amp;#52;&amp;#97;&amp;#51;&amp;#100;&amp;#57;&amp;#101;&amp;#101;&amp;#48;&amp;#99;&amp;#50;&amp;#54;&amp;#102;&amp;#48;&amp;#54;&amp;#98;</span><span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;/server&gt;</span>
    <span class="nt">&lt;/servers&gt;</span>
    <span class="nt">&lt;mirrors&gt;</span>
        <span class="nt">&lt;mirror&gt;</span>
            <span class="nt">&lt;id&gt;</span>thirdparty<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Snaplogic-ThirdPartyMaven-Repository<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://maven.clouddev.snaplogic.com:8080/nexus/content/repositories/thirdparty<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;mirrorOf&gt;</span>Snaplogic-ThirdPartyMaven-Repository,thirdparty,SnapArchetype-repo<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;/mirror&gt;</span>
    <span class="nt">&lt;/mirrors&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre><h3 id='rebuild-your-snap-pack'>Rebuild Your Snap Pack</h3>
<p>After updating your POM, rebuild your Snap Pack using Maven from the command-line. Ensure that your current directory is the root of your Snap Pack source code, where the pom.xml file is located.</p>

<p>Check that you have java version 1.8.x or later:</p>

<p><code>java -version</code></p>

<p>Check that you have Maven version 3.2.1 or later:</p>

<p><code>mvn --version</code></p>

<p>Build your Snap Pack:</p>

<p><code>mvn clean package</code></p>
<h3 id='deploy-your-snap-pack'>Deploy Your Snap Pack</h3>
<p>See <a href="#deploying-snap-packs">Deploying Snap Packs</a> for details about how to deploy your rebuilt Snap Pack.</p>
<h2 id='requesting-assistance'>Requesting Assistance</h2>
<p>We regret that our dependency improvements may have caused some of our customers disruptions with their custom Snaps.
We are offering direct support from the SnapLogic developers to resolve such issues. 
Please don’t hesitate to reach our team through one of the following channels:</p>

<ul>
<li><p>Post to the <a href="https://community.snaplogic.com/">SnapLogic Community</a> forum.
Any such posts and their responses become resources that others may find beneficial.</p></li>
<li><p>Email snap-dev@snaplogic.com and CC support@snaplogic.com. </p></li>
</ul>
<h1 id='snaplogic-api-usage-agreement'>SnapLogic API Usage Agreement</h1>
<p>This SnapLogic API Usage Agreement (“Agreement”) governs the implementation and use of SnapLogic APIs to allow a software application to interoperate with the SnapLogic Intelligent Integration Platform for internal development or testing purposes. Any malicious or unauthorized use of SnapLogic APIs will result in action against the entity. If You are entering into this Agreement on behalf of an organization, You represent You have the authority to bind Your organization to this Agreement. If You do not have that authority, or if You do not agree with the terms of this Agreement, You may not implement or use SnapLogic APIs. By utilizing, implementing, downloading or otherwise accessing SnapLogic APIs, You agree to be legally bound by the terms of this Agreement. This Agreement is effective between You and SnapLogic, Inc. (“SnapLogic”) as of the date of Your acceptance.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
